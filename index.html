<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AkÄ±llÄ±Market</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="AkÄ±llÄ± alÄ±ÅŸveriÅŸ asistanÄ±nÄ±z">
    <meta name="theme-color" content="#6366F1">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="AkÄ±llÄ±Market">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="./manifest.json">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #6366F1;
            --primary-dark: #4F46E5;
            --secondary-color: #F59E0B;
            --accent-color: #10B981;
            --background-color: #FAFBFC;
            --background-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --text-color: #1E293B;
            --text-light: #64748B;
            --card-background: #FFFFFF;
            --border-color: #E2E8F0;
            --shadow: 0 10px 25px rgba(99, 102, 241, 0.1);
            --shadow-hover: 0 20px 40px rgba(99, 102, 241, 0.2);
            --danger-color: #EF4444; /* Yeni: Tehlike rengi */
            --danger-dark: #DC2626;  /* Yeni: Tehlike koyu rengi */
        }

        [data-theme="dark"] {
            --primary-color: #818CF8;
            --primary-dark: #6366F1;
            --secondary-color: #FBBF24;
            --accent-color: #34D399;
            --background-color: #0F172A;
            --background-gradient: linear-gradient(135deg, #1e3a8a 0%, #7c3aed 100%);
            --text-color: #F1F5F9;
            --text-light: #94A3B8;
            --card-background: #1E293B;
            --border-color: #334155;
            --shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            --shadow-hover: 0 20px 40px rgba(0, 0, 0, 0.4);
            --danger-color: #F87171;
            --danger-dark: #EF4444;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: var(--background-color);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            min-height: 100vh;
            color: var(--text-color);
            transition: all 0.4s ease;
            font-weight: 400;
            line-height: 1.6;
            letter-spacing: -0.01em;
            /* Mobil cihazlarda daha iyi okunabilirlik iÃ§in varsayÄ±lan font boyutunu ayarlayÄ±n */
            font-size: 16px; 
        }

        body.large-text {
            font-size: 1.3em !important;
        }

        body.large-text .card-title {
            font-size: 28px !important;
        }

        body.high-contrast {
            filter: contrast(200%) brightness(1.2) !important;
        }

        body.high-contrast .card {
            border: 3px solid var(--text-color) !important;
            box-shadow: 0 0 20px rgba(0,0,0,0.6) !important;
        }

        .app-container {
            max-width: 420px;
            margin: 0 auto;
            min-height: 100vh;
            background: var(--background-color);
            /* Mobil cihazlarda kenar boÅŸluÄŸu bÄ±rakmak iÃ§in padding ekleyin */
            padding-bottom: 80px; /* bottom-nav yÃ¼ksekliÄŸi kadar */
        }

        /* Login */
        .login-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background: var(--background-gradient);
            color: white;
            padding: 20px;
            text-align: center; /* Logo ve metinleri ortala */
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 24px;
            background: rgba(255, 255, 255, 0.15);
            padding: 48px 36px;
            border-radius: 28px;
            backdrop-filter: blur(20px);
            width: 100%;
            max-width: 340px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }
        
        .login-logo-container {
            margin-bottom: 24px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 16px; /* Logo ve baÅŸlÄ±k arasÄ±na boÅŸluk */
        }

        .login-logo {
            font-size: 80px; /* Emoji boyutu */
            line-height: 1; /* SatÄ±r yÃ¼ksekliÄŸi */
            margin-bottom: 10px;
        }


        .login-form h1 {
            font-size: 36px;
            font-weight: 700;
            text-align: center;
            margin-bottom: 8px; /* Logoyla arasÄ±na boÅŸluk */
            line-height: 1.2;
        }

        .login-form p {
            text-align: center;
            opacity: 0.9;
            font-weight: 400;
            margin-bottom: 20px;
            font-size: 16px;
        }

        .login-form input {
            padding: 18px 24px;
            border: none;
            border-radius: 18px;
            font-size: 16px;
            font-weight: 500;
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            font-family: 'Inter', sans-serif;
            /* Mobil klavyelerde zoom olmamasÄ± iÃ§in minimum font boyutu */
            min-height: 52px; /* Dokunma hedefi iÃ§in minimum yÃ¼kseklik */
        }

        .login-form button {
            padding: 18px;
            border: none;
            border-radius: 18px;
            font-size: 16px;
            font-weight: 600;
            background: linear-gradient(135deg, #6366F1 0%, #4F46E5 100%);
            color: white;
            cursor: pointer;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
            min-height: 52px; /* Dokunma hedefi iÃ§in minimum yÃ¼kseklik */
        }

        .login-form button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(99, 102, 241, 0.4);
        }

        /* Header */
        .app-header {
            background: var(--background-gradient);
            color: white;
            padding: 28px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
            backdrop-filter: blur(20px);
        }

        .app-header h1 {
            font-size: 28px;
            font-weight: 700;
            letter-spacing: -0.02em;
            /* Mobil iÃ§in font boyutunu kÃ¼Ã§Ã¼lt */
            font-size: 24px;
            display: flex; /* Logo ve baÅŸlÄ±k iÃ§in flex */
            align-items: center;
            gap: 10px; /* Logo ve metin arasÄ±na boÅŸluk */
        }

        .header-logo {
            font-size: 32px; /* Emoji boyutu */
            line-height: 1; /* SatÄ±r yÃ¼ksekliÄŸi */
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 500;
            /* Mobil iÃ§in font boyutunu kÃ¼Ã§Ã¼lt */
            font-size: 14px;
        }

        .user-info button {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 10px 18px;
            border-radius: 14px;
            cursor: pointer;
            font-weight: 500;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
            /* Dokunma hedefi iÃ§in minimum boyut */
            min-width: 44px;
            min-height: 44px;
        }

        .user-info button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }

        /* Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 420px;
            background: var(--card-background);
            display: flex;
            justify-content: space-around;
            padding: 12px 0; /* Daha az padding mobil iÃ§in */
            border-top: 1px solid var(--border-color);
            box-shadow: 0 -10px 25px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(20px);
            z-index: 100; /* DiÄŸer elementlerin Ã¼zerinde olduÄŸundan emin olun */
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px; /* Daha az gap mobil iÃ§in */
            cursor: pointer;
            padding: 8px 12px; /* Daha az padding mobil iÃ§in */
            border-radius: 16px;
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 11px; /* Daha kÃ¼Ã§Ã¼k font boyutu mobil iÃ§in */
            color: var(--text-light);
            /* Dokunma hedefi iÃ§in yeterli alan saÄŸlayÄ±n */
            min-width: 60px;
            min-height: 60px;
            justify-content: center;
        }

        .nav-item.active {
            background: rgba(99, 102, 241, 0.1);
            color: var(--primary-color);
            transform: translateY(-2px);
        }

        .nav-icon {
            font-size: 20px; /* Daha kÃ¼Ã§Ã¼k ikon boyutu mobil iÃ§in */
            transition: all 0.3s ease;
        }

        .nav-item.active .nav-icon {
            transform: scale(1.1);
        }

        /* Main Content */
        .main-content {
            padding: 24px 20px;
            padding-bottom: 120px; /* Alt navigasyon Ã§ubuÄŸu iÃ§in boÅŸluk */
            min-height: calc(100vh - 160px);
        }

        /* Cards */
        .card {
            background: var(--card-background);
            border-radius: 24px;
            padding: 32px;
            margin-bottom: 24px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .card:hover {
            box-shadow: var(--shadow-hover);
            transform: translateY(-2px);
        }

        .card-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-color);
            margin-bottom: 20px;
            letter-spacing: -0.02em;
            /* Mobil iÃ§in font boyutunu kÃ¼Ã§Ã¼lt */
            font-size: 20px;
        }

        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: var(--background-gradient);
            color: white;
            padding: 20px 15px; /* Mobil iÃ§in padding ayarÄ± */
            border-radius: 20px;
            text-align: center;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-hover);
        }

        .stat-number {
            font-size: 32px;
            font-weight: 700;
            display: block;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 13px;
            opacity: 0.9;
            font-weight: 500;
        }

        /* Input Groups */
        .input-group {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
            flex-wrap: wrap; /* Mobil iÃ§in satÄ±r atlama */
        }

        .input-group input, .input-group select, 
        .two-column-input input, .two-column-input select {
            flex: 1;
            padding: 16px 20px; /* Mobil iÃ§in padding ayarÄ± */
            border: 2px solid transparent;
            border-radius: 20px;
            font-size: 15px; /* Mobil iÃ§in font boyutu */
            font-weight: 500;
            background: linear-gradient(145deg, #f8fafc 0%, #f1f5f9 100%);
            color: var(--text-color);
            font-family: 'Inter', sans-serif;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            letter-spacing: -0.01em;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            min-height: 50px; /* Dokunma hedefi iÃ§in minimum yÃ¼kseklik */
        }
        /* Inputlar mobil ekranlarda tam geniÅŸlikte olsun */
        @media (max-width: 480px) {
            .input-group input, .input-group select,
            .two-column-input input, .two-column-input select {
                width: 100%;
                flex-basis: 100%; /* Flex item olarak tam geniÅŸlik */
            }
            .input-group {
                flex-direction: column; /* Input grubunu dikey sÄ±rala */
            }
        }


        .two-column-input {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 24px;
        }
        /* Ä°ki sÃ¼tunlu input mobil ekranlarda tek sÃ¼tuna dÃ¼ÅŸsÃ¼n */
        @media (max-width: 480px) {
            .two-column-input {
                grid-template-columns: 1fr;
            }
            .two-column-input > div { /* Ä°Ã§indeki div'i de tam geniÅŸlik yapÄ±n */
                display: flex;
                gap: 12px;
                width: 100%;
            }
             .two-column-input input[type="number"], .two-column-input select {
                width: 100% !important; /* Miktar ve birim inputlarÄ±nÄ± da geniÅŸletin */
                flex: 1; /* EsnekliÄŸi koruyun */
            }
        }

        .input-group input:focus, .input-group select:focus,
        .two-column-input input:focus, .two-column-input select:focus {
            outline: none;
            border-color: var(--primary-color);
            background: white;
            box-shadow: 
                0 0 0 4px rgba(99, 102, 241, 0.1),
                0 8px 25px rgba(99, 102, 241, 0.15);
            transform: translateY(-2px);
        }

        .input-group input:hover, .input-group select:hover,
        .two-column-input input:hover, .two-column-input select:hover {
            background: white;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
            transform: translateY(-1px);
        }

        /* Dark Mode iÃ§in Input */
        [data-theme="dark"] .input-group input, 
        [data-theme="dark"] .input-group select,
        [data-theme="dark"] .two-column-input input,
        [data-theme="dark"] .two-column-input select {
            background: linear-gradient(145deg, #1e293b 0%, #334155 100%);
            color: var(--text-color);
            border-color: transparent;
        }

        [data-theme="dark"] .input-group input:focus,
        [data-theme="dark"] .input-group select:focus,
        [data-theme="dark"] .two-column-input input:focus,
        [data-theme="dark"] .two-column-input select:focus {
            background: #1e293b;
            border-color: var(--primary-color);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            padding: 16px 24px; /* Mobil iÃ§in padding ayarÄ± */
            border-radius: 16px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(99, 102, 241, 0.3);
            letter-spacing: -0.01em;
            min-height: 52px; /* Dokunma hedefi iÃ§in minimum yÃ¼kseklik */
            width: 100%; /* Mobil cihazlarda tam geniÅŸlik */
            box-sizing: border-box; /* Padding dahil geniÅŸlik */
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 30px rgba(99, 102, 241, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--secondary-color) 0%, #F59E0B 100%);
            color: white;
            border: none;
            padding: 16px 24px; /* Mobil iÃ§in padding ayarÄ± */
            border-radius: 16px;
            cursor: pointer;
            font-weight: 600;
            font-family: 'Inter', sans-serif;
            width: 100%;
            transition: all 0.3s ease;
            box-shadow: 0 6px 15px rgba(245, 158, 11, 0.3);
            letter-spacing: -0.01em;
            min-height: 52px; /* Dokunma hedefi iÃ§in minimum yÃ¼kseklik */
            box-sizing: border-box;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(245, 158, 11, 0.4);
        }

        /* Shopping Item - YENÄ° TASARIM */
        .shopping-item {
            display: flex;
            align-items: center;
            padding: 16px; /* Mobil iÃ§in padding ayarÄ± */
            background: var(--card-background);
            border-radius: 16px;
            margin-bottom: 12px;
            gap: 12px; /* Daha az gap mobil iÃ§in */
            border: 2px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .shopping-item:hover {
            border-color: var(--primary-color);
            transform: translateY(-1px);
            box-shadow: var(--shadow);
        }

        .shopping-item.completed {
            background: #F1F5F9;
            opacity: 0.8;
        }
        [data-theme="dark"] .shopping-item.completed {
            background: #334155; /* Dark mode iÃ§in completed item rengi */
        }

        .shopping-item.completed .shopping-item-name {
            text-decoration: line-through;
            color: var(--text-light);
        }

        /* Tik Butonu */
        .check-btn {
            width: 38px; /* Dokunma hedefi iÃ§in boyut bÃ¼yÃ¼tÃ¼ldÃ¼ */
            height: 38px; /* Dokunma hedefi iÃ§in boyut bÃ¼yÃ¼tÃ¼ldÃ¼ */
            border-radius: 50%;
            border: 3px solid var(--border-color);
            background: transparent;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            font-size: 18px; /* Ä°kon boyutu bÃ¼yÃ¼tÃ¼ldÃ¼ */
            color: transparent;
            flex-shrink: 0; /* Ä°Ã§eriÄŸin sÄ±kÄ±ÅŸmasÄ±nÄ± Ã¶nler */
        }

        .check-btn.completed {
            background: var(--accent-color) !important;
            border-color: var(--accent-color) !important;
            color: white !important;
        }

        .check-btn:hover {
            border-color: var(--accent-color);
            background: rgba(16, 185, 129, 0.1);
        }

        .shopping-item-content {
            flex: 1;
            /* Metinlerin taÅŸmasÄ±nÄ± engellemek iÃ§in */
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
        }
        /* Uzun metinlerin birden fazla satÄ±ra yayÄ±lmasÄ± iÃ§in */
        .shopping-item-name, .shopping-item-meta {
            white-space: normal;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .shopping-item-name {
            font-weight: 600;
            color: var(--text-color);
            font-size: 16px;
            margin-bottom: 4px;
        }

        .shopping-item-meta {
            font-size: 12px;
            color: var(--text-light);
        }

        /* Delete Button */
        .delete-btn {
            background: linear-gradient(135deg, var(--danger-color) 0%, var(--danger-dark) 100%) !important;
            color: white !important;
            border: none !important;
            padding: 10px 14px !important;
            border-radius: 12px !important;
            cursor: pointer !important;
            font-size: 16px !important;
            transition: all 0.3s ease !important;
            min-width: 44px !important;
            min-height: 44px !important; /* Dokunma hedefi iÃ§in minimum yÃ¼kseklik */
            z-index: 999 !important;
            position: relative !important;
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3) !important;
            flex-shrink: 0; /* Ä°Ã§eriÄŸin sÄ±kÄ±ÅŸmasÄ±nÄ± Ã¶nler */
        }

        .delete-btn:hover {
            background: linear-gradient(135deg, #DC2626 0%, #B91C1C 100%) !important;
            transform: translateY(-2px) scale(1.05) !important;
            box-shadow: 0 8px 20px rgba(239, 68, 68, 0.4) !important;
        }

        /* AI Suggestions */
        .ai-suggestions {
            background: var(--card-background);
            border: 1px solid var(--border-color);
            padding: 24px;
            border-radius: 20px;
            border-left: 5px solid var(--primary-color);
            margin-bottom: 24px;
            animation: slideIn 0.5s ease-out;
            box-shadow: var(--shadow);
            color: var(--text-color);
        }

        /* Dark mode iÃ§in Ã¶zel AI suggestions stili */
        [data-theme='dark'] .ai-suggestions {
            background: #2D3748;
            border-color: #4A5568;
            color: #E2E8F0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }

        /* AI suggestions iÃ§indeki malzeme Ã¶ÄŸeleri iÃ§in ek kontrast */
        .ai-suggestions h3 {
            color: var(--text-color);
            margin-bottom: 16px;
        }

        [data-theme='dark'] .ai-suggestions h3 {
            color: #F7FAFC;
        }

        /* Malzeme listesi Ã¶ÄŸeleri iÃ§in stil */
        .ai-suggestions div[style*="display: flex"] {
            color: var(--text-color);
        }

        [data-theme='dark'] .ai-suggestions div[style*="display: flex"] {
            color: #E2E8F0;
        }

        /* Malzeme miktarlarÄ± iÃ§in stil */
        .ai-suggestions span[style*="color: var(--text-light)"] {
            color: var(--text-light) !important;
        }

        [data-theme='dark'] .ai-suggestions span[style*="color: var(--text-light)"] {
            color: #A0AEC0 !important;
        }

        /* AI Bot Response */
        .ai-bot-response {
            background: var(--card-background);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 20px;
            margin: 16px 0;
            font-size: 15px;
            line-height: 1.6;
            color: var(--text-color);
            box-shadow: var(--shadow);
            transition: background 0.3s, border-color 0.3s, color 0.3s;
        }

        /* AI Bot Response iÃ§in Ã¶zel dark mode iyileÅŸtirmesi */
        [data-theme='dark'] .ai-bot-response {
            background: #2D3748;
            border-color: #4A5568;
            color: #E2E8F0;
        }

        /* AI Bot iÃ§indeki Ã¼rÃ¼n listesi iÃ§in ek kontrast */
        .ai-bot-response strong {
            color: var(--primary-color);
            font-weight: 600;
        }

        [data-theme='dark'] .ai-bot-response strong {
            color: #A3BFFA;
        }
        
        /* AI Bot Ã¼rÃ¼n Ã¶nerileri iÃ§in liste stili */
        .ai-bot-response ul,
        .ai-bot-response ol {
            margin: 12px 0;
            padding-left: 20px;
        }

        .ai-bot-response li {
            margin: 8px 0;
            color: var(--text-color);
        }

        [data-theme='dark'] .ai-bot-response li {
            color: #CBD5E0;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-15px); }
            to { opacity: 1; transform: translateX(0); }
        }
    
        /* Settings */
        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid var(--border-color);
            flex-wrap: wrap; /* KÃ¼Ã§Ã¼k ekranlarda sarmalama */
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .setting-label {
            font-weight: 600;
            color: var(--text-color);
            font-size: 16px;
            flex-basis: 100%; /* KÃ¼Ã§Ã¼k ekranlarda etiketin tam geniÅŸlik olmasÄ± */
            margin-bottom: 4px; /* KÃ¼Ã§Ã¼k ekranlarda aÃ§Ä±klama ile arasÄ±na boÅŸluk */
        }

        .setting-description {
            font-size: 14px;
            color: var(--text-light);
            margin-top: 4px;
            flex-basis: 100%; /* KÃ¼Ã§Ã¼k ekranlarda aÃ§Ä±klamanÄ±n tam geniÅŸlik olmasÄ± */
        }
        /* Toggle switch iÃ§in flex dÃ¼zeni */
        .setting-item > div:first-child {
            flex: 1; /* Etiket ve aÃ§Ä±klama iÃ§in esneklik */
        }
        .setting-item > .toggle-switch {
            margin-left: auto; /* SaÄŸa yaslama */
            flex-shrink: 0; /* KÃ¼Ã§Ã¼lmesini engelle */
        }


        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            width: 56px;
            height: 28px;
            background: #CBD5E1;
            border-radius: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 56px; /* Dokunma hedefi iÃ§in minimum boyut */
            min-height: 28px;
        }

        .toggle-switch.active {
            background: var(--primary-color) !important;
        }

        .toggle-slider {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 22px;
            height: 22px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(28px);
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 24px;
            right: 24px;
            background: var(--card-background);
            color: var(--text-color);
            padding: 18px 24px;
            border-radius: 16px;
            z-index: 1001;
            transform: translateX(400px);
            transition: all 0.4s ease;
            box-shadow: var(--shadow-hover);
            border: 1px solid var(--border-color);
            font-weight: 500;
            max-width: 320px;
            word-wrap: break-word; /* Uzun metinlerin sarmalanmasÄ± iÃ§in */
            left: 50%; /* Mobil ortalama */
            transform: translateX(-50%) translateY(-100%); /* BaÅŸlangÄ±Ã§ta yukarÄ±da gizli */
            right: auto; /* SaÄŸdan hizalamayÄ± kaldÄ±r */
        }

        .notification.show {
            transform: translateX(-50%) translateY(0); /* Ortadan gÃ¶rÃ¼nÃ¼r hale gelmesi */
        }

        /* Category Headers */
        .category-header {
            background: var(--background-gradient);
            color: white;
            padding: 16px 20px; /* Mobil iÃ§in padding ayarÄ± */
            border-radius: 20px;
            font-weight: 700;
            font-size: 17px; /* Mobil iÃ§in font boyutu */
            margin-bottom: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
        }

        /* Responsive */
        @media (max-width: 480px) {
            body {
                font-size: 15px; /* Daha kÃ¼Ã§Ã¼k mobil cihazlar iÃ§in temel font boyutu */
            }
            .app-header {
                padding: 20px 16px; /* Header padding mobil iÃ§in */
            }
            .app-header h1 {
                font-size: 22px;
            }
            .user-info {
                font-size: 13px;
            }
            .main-content {
                padding: 20px 16px; /* Main content padding mobil iÃ§in */
                padding-bottom: 100px; /* Alt navigasyon iÃ§in boÅŸluk */
            }
            .card {
                padding: 24px; /* Card padding mobil iÃ§in */
                border-radius: 20px; /* Card border-radius mobil iÃ§in */
            }
            .card-title {
                font-size: 18px; /* Card title font size mobil iÃ§in */
            }
            .stats-grid {
                grid-template-columns: repeat(2, 1fr); /* 2 sÃ¼tun */
                gap: 12px;
            }
            .stat-card {
                padding: 18px 10px; /* Stat card padding mobil iÃ§in */
            }
            .stat-number {
                font-size: 28px; /* Stat number font size mobil iÃ§in */
            }
            .login-form h1 {
                font-size: 30px; /* Login title font size mobil iÃ§in */
            }
            .login-form input, .login-form button {
                font-size: 15px; /* Login form input/button font size mobil iÃ§in */
                padding: 16px 20px;
            }
            .bottom-nav {
                padding: 10px 0;
            }
            .nav-item {
                font-size: 10px;
                padding: 8px 8px;
            }
            .nav-icon {
                font-size: 18px;
            }
            .btn-primary, .btn-secondary {
                padding: 14px 20px;
                font-size: 15px;
            }
        }

        /* YENÄ° EKLENDÄ° - Sesli Komut Butonu */
        .voice-btn {
            background: none;
            border: none;
            font-size: 28px;
            color: var(--primary-color);
            cursor: pointer;
            padding: 10px;
            border-radius: 50%;
            transition: all 0.3s ease;
            height: 64px;
            width: 64px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0; /* Flex konteyner iÃ§inde kÃ¼Ã§Ã¼lmesini engeller */
        }

        .voice-btn:hover {
            background: rgba(99, 102, 241, 0.1);
        }

        .voice-btn.listening {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.7); }
            70% { transform: scale(1.1); box-shadow: 0 0 10px 20px rgba(99, 102, 241, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(99, 102, 241, 0); }
        }

        /* YENÄ° EKLENDÄ° - AkÄ±llÄ± ÃœrÃ¼n Ã–nerileri */
        .suggestions-container {
            position: relative;
            width: 100%;
        }

        #product-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--card-background);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            margin-top: 8px;
            z-index: 1000;
            max-height: 180px;
            overflow-y: auto;
            box-shadow: var(--shadow);
        }

        .suggestion-item {
            padding: 14px 20px;
            cursor: pointer;
            border-bottom: 1px solid var(--border-color);
            transition: background 0.2s ease;
            font-weight: 500;
            font-size: 15px; /* Ã–neri metni font boyutu */
        }

        .suggestion-item:last-child {
            border-bottom: none;
        }

        .suggestion-item:hover {
            background: rgba(99, 102, 241, 0.1);
            color: var(--primary-color);
        }

        /* Custom Confirmation Modal */
        .confirm-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .confirm-modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .confirm-modal-content {
            background: var(--card-background);
            padding: 30px;
            border-radius: 20px;
            box-shadow: var(--shadow-hover);
            text-align: center;
            max-width: 320px;
            width: 90%;
            transform: translateY(20px);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }

        .confirm-modal-overlay.show .confirm-modal-content {
            transform: translateY(0);
            opacity: 1;
        }

        .confirm-modal-content h3 {
            font-size: 20px;
            margin-bottom: 15px;
            color: var(--text-color);
        }

        .confirm-modal-content p {
            font-size: 15px;
            color: var(--text-light);
            margin-bottom: 25px;
        }

        .confirm-modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .confirm-modal-buttons button {
            flex: 1;
            padding: 12px 20px;
            border-radius: 14px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .confirm-modal-buttons .btn-yes {
            background: linear-gradient(135deg, var(--danger-color) 0%, var(--danger-dark) 100%);
            color: white;
            border: none;
        }

        .confirm-modal-buttons .btn-yes:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .confirm-modal-buttons .btn-no {
            background: var(--border-color);
            color: var(--text-color);
            border: none;
        }

        .confirm-modal-buttons .btn-no:hover {
            background: #CBD5E1;
            transform: translateY(-1px);
        }
        [data-theme="dark"] .confirm-modal-buttons .btn-no {
            background: #4A5568;
            color: #E2E8F0;
        }
        [data-theme="dark"] .confirm-modal-buttons .btn-no:hover {
            background: #606F87;
        }
    </style>
</head>
<body>
    <!-- Notification -->
    <div id="notification" class="notification">
        <div id="notificationText"></div>
    </div>

    <!-- Custom Confirmation Modal -->
    <div id="confirmModalOverlay" class="confirm-modal-overlay">
        <div class="confirm-modal-content">
            <h3 id="confirmModalTitle">Emin Misiniz?</h3>
            <p id="confirmModalMessage">Bu iÅŸlemi gerÃ§ekleÅŸtirmek istediÄŸinize emin misiniz?</p>
            <div class="confirm-modal-buttons">
                <button id="confirmBtnNo" class="btn-no">HayÄ±r</button>
                <button id="confirmBtnYes" class="btn-yes">Evet</button>
            </div>
        </div>
    </div>

    <div id="app" class="app-container"></div>

    <script>
        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => console.log('SW registered'))
                    .catch(error => console.log('SW registration failed'));
            });
        }

        // Global state
        let appState = {
            user: null,
            currentPage: 'home',
            shoppingList: JSON.parse(localStorage.getItem('akilliMarket_shoppingList') || '[]'),
            newItem: '',
            newQuantity: '1',
            newUnit: 'adet',
            aiQuery: '',
            aiSuggestions: [],
            aiBotResponse: '',
            chefName: localStorage.getItem('akilliMarket_chefName') || 'AÅŸÃ§Ä± Bey',
            sharedUsers: JSON.parse(localStorage.getItem('akilliMarket_sharedUsers') || '[]'),
            shareCode: localStorage.getItem('akilliMarket_shareCode') || null,
            settings: JSON.parse(localStorage.getItem('akilliMarket_settings') || '{"darkMode":false,"highContrast":false,"largeText":false}'),
            productSuggestions: [],
            aiGeneratedRecipe: null // New state variable for generated recipe
        };

        // AI AÅŸÃ§Ä± Yemek VeritabanÄ±
        const chefMealDatabase = {
            "mercimek Ã§orbasÄ±": {
                ingredients: [
                    { name: 'kÄ±rmÄ±zÄ± mercimek', quantity: '1 su bardaÄŸÄ±' },
                    { name: 'soÄŸan', quantity: '1 adet' },
                    { name: 'havuÃ§', quantity: '1 adet' },
                    { name: 'patates', quantity: '1 adet' },
                    { name: 'tereyaÄŸÄ±', quantity: '50g' },
                    { name: 'un', quantity: '1 yemek kaÅŸÄ±ÄŸÄ±' },
                    { name: 'tuz', quantity: '1 Ã§ay kaÅŸÄ±ÄŸÄ±' }
                ],
                response: "ğŸ² Besleyici mercimek Ã§orbasÄ±! Protein aÃ§Ä±sÄ±ndan zengin ve saÄŸlÄ±klÄ± bir seÃ§im.",
                instructions: [
                    "Mercimekleri yÄ±kayÄ±n ve tencereye alÄ±n.",
                    "SoÄŸan, havuÃ§ ve patatesi kÃ¼p kÃ¼p doÄŸrayÄ±p tencereye ekleyin.",
                    "Ãœzerini geÃ§ecek kadar su ekleyip sebzeler yumuÅŸayana kadar piÅŸirin.",
                    "AyrÄ± bir tavada tereyaÄŸÄ±nda un kavurun, salÃ§a ekleyip kokusu Ã§Ä±kana kadar kavurun.",
                    "SÄ±cak suyla inceltip Ã§orbaya ekleyin. Tuz ve baharatlarÄ± ayarlayÄ±n.",
                    "Blenderdan geÃ§irip pÃ¼rÃ¼zsÃ¼z hale getirin. Servis yapÄ±n."
                ]
            },
            "makarna": {
                ingredients: [
                    { name: 'makarna', quantity: '500g' },
                    { name: 'domates sosu', quantity: '1 kutu' },
                    { name: 'parmesan peyniri', quantity: '100g' },
                    { name: 'zeytinyaÄŸÄ±', quantity: '3 yemek kaÅŸÄ±ÄŸÄ±' }
                ],
                response: "ğŸ Makarna iÃ§in gerekli malzemeler hazÄ±rlandÄ±! Klasik bir Ä°talyan lezzeti iÃ§in bu malzemeler yeterli.",
                instructions: [
                    "MakarnayÄ± bol tuzlu suda paketin Ã¼zerindeki tarife gÃ¶re haÅŸlayÄ±n.",
                    "AyrÄ± bir tavada zeytinyaÄŸÄ±nda domates sosunu Ä±sÄ±tÄ±n.",
                    "HaÅŸlanmÄ±ÅŸ makarnayÄ± sÃ¼zÃ¼p sosla karÄ±ÅŸtÄ±rÄ±n.",
                    "Servis yaparken Ã¼zerine rendelenmiÅŸ parmesan peyniri serpin."
                ]
            },
            "omlet": {
                ingredients: [
                    { name: 'yumurta', quantity: '3 adet' },
                    { name: 'sÃ¼t', quantity: '3 yemek kaÅŸÄ±ÄŸÄ±' },
                    { name: 'peynir', quantity: '100g' },
                    { name: 'tereyaÄŸÄ±', quantity: '1 yemek kaÅŸÄ±ÄŸÄ±' }
                ],
                response: "ğŸ³ MÃ¼kemmel bir omlet iÃ§in gerekli malzemeler! Protein aÃ§Ä±sÄ±ndan zengin ve doyurucu bir kahvaltÄ±.",
                instructions: [
                    "YumurtalarÄ± bir kasede sÃ¼t ile Ã§Ä±rpÄ±n.",
                    "TavayÄ± tereyaÄŸÄ± ile yaÄŸlayÄ±p Ä±sÄ±tÄ±n.",
                    "Yumurta karÄ±ÅŸÄ±mÄ±nÄ± tavaya dÃ¶kÃ¼n. Ãœzerine peynir serpin.",
                    "KÄ±sÄ±k ateÅŸte peynir eriyip omlet piÅŸene kadar piÅŸirin. Katlayarak servis edin."
                ]
            },
            "salata": {
                ingredients: [
                    { name: 'marul', quantity: '1 adet' },
                    { name: 'domates', quantity: '2 adet' },
                    { name: 'salatalÄ±k', quantity: '1 adet' },
                    { name: 'zeytinyaÄŸÄ±', quantity: '3 yemek kaÅŸÄ±ÄŸÄ±' },
                    { name: 'limon', quantity: '1 adet' }
                ],
                response: "ğŸ¥— Taze ve saÄŸlÄ±klÄ± salata malzemeleri! Vitamin aÃ§Ä±sÄ±ndan zengin bir Ã¶ÄŸÃ¼n iÃ§in ideal.",
                instructions: [
                    "Marul, domates ve salatalÄ±ÄŸÄ± yÄ±kayÄ±p doÄŸrayÄ±n.",
                    "GeniÅŸ bir kasede tÃ¼m malzemeleri karÄ±ÅŸtÄ±rÄ±n.",
                    "ZeytinyaÄŸÄ± ve limon suyu ile tatlandÄ±rÄ±n. Ä°steÄŸe gÃ¶re tuz ekleyin."
                ]
            },
            "tavuk Ã§orbasÄ±": {
                ingredients: [
                    { name: 'tavuk eti', quantity: '500g' },
                    { name: 'havuÃ§', quantity: '2 adet' },
                    { name: 'soÄŸan', quantity: '1 adet' },
                    { name: 'pirinÃ§', quantity: '1/2 su bardaÄŸÄ±' },
                    { name: 'tuz', quantity: '1 Ã§ay kaÅŸÄ±ÄŸÄ±' }
                ],
                response: "ğŸ² Besleyici tavuk Ã§orbasÄ± malzemeleri! Hasta olduÄŸunuzda veya soÄŸuk havalarda ideal.",
                instructions: [
                    "Tavuk etini haÅŸlayÄ±n, didin ve suyunu saklayÄ±n.",
                    "HavuÃ§ ve soÄŸanÄ± doÄŸrayÄ±p tereyaÄŸÄ±nda kavurun.",
                    "Tavuk suyu ve pirinci ekleyip pirinÃ§ler yumuÅŸayana kadar piÅŸirin.",
                    "DidilmiÅŸ tavuk etini ve tuzu ekleyip bir taÅŸÄ±m daha kaynatÄ±n. Servis edin."
                ]
            },
            "pizza": {
                ingredients: [
                    { name: 'pizza hamuru', quantity: '2 adet' },
                    { name: 'domates sosu', quantity: '1 kutu' },
                    { name: 'mozzarella peyniri', quantity: '300g' },
                    { name: 'sucuk', quantity: '200g' },
                    { name: 'mantar', quantity: '250g' }
                ],
                response: "ğŸ• Ev yapÄ±mÄ± pizza malzemeleri! Ailenizle birlikte eÄŸlenceli bir yemek deneyimi.",
                instructions: [
                    "Pizza hamurunu aÃ§Ä±n ve fÄ±rÄ±n tepsisine yerleÅŸtirin.",
                    "Ãœzerine domates sosu sÃ¼rÃ¼n, mozzarella peyniri ve diÄŸer malzemeleri ekleyin.",
                    "Ã–nceden Ä±sÄ±tÄ±lmÄ±ÅŸ 200Â°C fÄ±rÄ±nda peynir eriyip kenarlarÄ± kÄ±zarana kadar piÅŸirin."
                ]
            },
            "tavuklu pilav": {
                ingredients: [
                    { name: 'tavuk eti', quantity: '500g' },
                    { name: 'pirinÃ§', quantity: '2 su bardaÄŸÄ±' },
                    { name: 'soÄŸan', quantity: '1 adet' },
                    { name: 'tereyaÄŸÄ±', quantity: '50g' },
                    { name: 'tavuk suyu', quantity: '3 su bardaÄŸÄ±' },
                    { name: 'tuz', quantity: '1 Ã§ay kaÅŸÄ±ÄŸÄ±' },
                    { name: 'karabiber', quantity: '1 Ã§ay kaÅŸÄ±ÄŸÄ±' }
                ],
                response: "ğŸš Geleneksel tavuklu pilav malzemeleri! TÃ¼rk mutfaÄŸÄ±nÄ±n vazgeÃ§ilmez lezzeti.",
                instructions: [
                    "PirinÃ§leri yÄ±kayÄ±p sÃ¼zÃ¼n. Tavuk etini haÅŸlayÄ±p didin.",
                    "SoÄŸanÄ± ince ince doÄŸrayÄ±p tereyaÄŸÄ±nda kavurun.",
                    "PirinÃ§leri ekleyip 2-3 dakika daha kavurun.",
                    "Tavuk suyu ve tuzu ekleyip kÄ±sÄ±k ateÅŸte pirinÃ§ler suyunu Ã§ekene kadar piÅŸirin.",
                    "DidilmiÅŸ tavuk etini ekleyip karÄ±ÅŸtÄ±rÄ±n. Demlenmeye bÄ±rakÄ±n."
                ]
            },
            "karnÄ±yarÄ±k": {
                ingredients: [
                    { name: 'patlÄ±can', quantity: '6 adet' },
                    { name: 'kÄ±yma', quantity: '500g' },
                    { name: 'soÄŸan', quantity: '2 adet' },
                    { name: 'domates', quantity: '3 adet' },
                    { name: 'biber', quantity: '2 adet' },
                    { name: 'zeytinyaÄŸÄ±', quantity: '1/2 su bardaÄŸÄ±' },
                    { name: 'maydanoz', quantity: '1 demet' }
                ],
                response: "ğŸ† Enfes karnÄ±yarÄ±k malzemeleri! TÃ¼rk mutfaÄŸÄ±nÄ±n en sevilen yemeklerinden biri.",
                instructions: [
                    "PatlÄ±canlarÄ± alacalÄ± soyup kÄ±zartÄ±n. OrtalarÄ±nÄ± aÃ§Ä±p iÃ§lerini oyup tuzlayÄ±n.",
                    "KÄ±ymayÄ± soÄŸan, domates, biber ve maydanoz ile kavurun. Baharat ekleyin.",
                    "PatlÄ±canlarÄ±n iÃ§ini kÄ±ymalÄ± harÃ§la doldurun.",
                    "FÄ±rÄ±n tepsisine dizip Ã¼zerine domates ve biber dilimleri koyun.",
                    "Biraz su ekleyip 180Â°C fÄ±rÄ±nda 20-25 dakika piÅŸirin."
                ]
            },
            "menemen": {
                ingredients: [
                    { name: 'yumurta', quantity: '4 adet' },
                    { name: 'domates', quantity: '3 adet' },
                    { name: 'biber', quantity: '2 adet' },
                    { name: 'soÄŸan', quantity: '1 adet' },
                    { name: 'zeytinyaÄŸÄ±', quantity: '3 yemek kaÅŸÄ±ÄŸÄ±' },
                    { name: 'tuz', quantity: '1 Ã§ay kaÅŸÄ±ÄŸÄ±' }
                ],
                response: "ğŸ³ Lezzetli menemen malzemeleri! TÃ¼rk kahvaltÄ±sÄ±nÄ±n vazgeÃ§ilmez lezzeti.",
                instructions: [
                    "SoÄŸan ve biberleri ince ince doÄŸrayÄ±p zeytinyaÄŸÄ±nda kavurun.",
                    "Domatesleri rendeleyip veya kÃ¼p kÃ¼p doÄŸrayÄ±p tavaya ekleyin. Suyunu Ã§ekene kadar piÅŸirin.",
                    "YumurtalarÄ± kÄ±rÄ±p karÄ±ÅŸtÄ±rÄ±n. Tuz ekleyin.",
                    "Yumurtalar piÅŸince ocaktan alÄ±p sÄ±cak servis yapÄ±n."
                ]
            },
            "kÃ¶fte": {
                ingredients: [
                    { name: 'kÄ±yma', quantity: '500g' },
                    { name: 'soÄŸan', quantity: '1 adet' },
                    { name: 'ekmek iÃ§i', quantity: '2 dilim' },
                    { name: 'yumurta', quantity: '1 adet' },
                    { name: 'maydanoz', quantity: '1 demet' },
                    { name: 'tuz', quantity: '1 Ã§ay kaÅŸÄ±ÄŸÄ±' },
                    { name: 'karabiber', quantity: '1 Ã§ay kaÅŸÄ±ÄŸÄ±' }
                ],
                response: "ğŸ¥© Ev yapÄ±mÄ± kÃ¶fte malzemeleri! Herkesin sevdiÄŸi klasik lezzet.",
                instructions: [
                    "KÄ±yma, rendelenmiÅŸ soÄŸan, Ä±slatÄ±lÄ±p sÄ±kÄ±lmÄ±ÅŸ ekmek iÃ§i, yumurta, doÄŸranmÄ±ÅŸ maydanoz, tuz ve karabiberi bir kapta yoÄŸurun.",
                    "HarÃ§tan ceviz bÃ¼yÃ¼klÃ¼ÄŸÃ¼nde parÃ§alar alÄ±p yuvarlayÄ±n veya yassÄ±ltÄ±n.",
                    "Tavada az yaÄŸda veya fÄ±rÄ±nda piÅŸirin. Ä°steÄŸe gÃ¶re kÄ±zartÄ±n veya Ä±zgara yapÄ±n."
                ]
            },
            "dÃ¶ner": {
                ingredients: [
                    { name: 'tavuk eti', quantity: '1 kg' },
                    { name: 'lavash', quantity: '6 adet' },
                    { name: 'domates', quantity: '2 adet' },
                    { name: 'salatalÄ±k', quantity: '1 adet' },
                    { name: 'soÄŸan', quantity: '1 adet' },
                    { name: 'marul', quantity: '1 adet' },
                    { name: 'sos', quantity: '2 Ã§eÅŸit' }
                ],
                response: "ğŸŒ¯ Ev yapÄ±mÄ± dÃ¶ner malzemeleri! Sokak lezzetini evinizde yapÄ±n.",
                instructions: [
                    "Tavuk etini ince ince dilimleyin veya jÃ¼lyen doÄŸrayÄ±n.",
                    "Bir tavada etleri yÃ¼ksek ateÅŸte kÄ±zartÄ±n.",
                    "Lavash ekmeÄŸini Ä±sÄ±tÄ±n. Ãœzerine etleri yerleÅŸtirin.",
                    "DoÄŸranmÄ±ÅŸ domates, salatalÄ±k, soÄŸan ve marulu ekleyin.",
                    "Ä°steÄŸe gÃ¶re sos ekleyip dÃ¼rÃ¼m yapÄ±n."
                ]
            },
            "mantÄ±": {
                ingredients: [
                    { name: 'un', quantity: '500g' },
                    { name: 'yumurta', quantity: '2 adet' },
                    { name: 'kÄ±yma', quantity: '300g' },
                    { name: 'soÄŸan', quantity: '1 adet' },
                    { name: 'yoÄŸurt', quantity: '500g' },
                    { name: 'sarÄ±msak', quantity: '3 diÅŸ' },
                    { name: 'tereyaÄŸÄ±', quantity: '100g' }
                ],
                response: "ğŸ¥Ÿ Geleneksel mantÄ± malzemeleri! TÃ¼rk mutfaÄŸÄ±nÄ±n en Ã¶zel lezzetlerinden.",
                instructions: [
                    "Un, yumurta ve tuz ile sert bir hamur yoÄŸurun. Dinlendirin.",
                    "KÄ±yma ve rendelenmiÅŸ soÄŸan ile iÃ§ harcÄ± hazÄ±rlayÄ±n. Tuz ve karabiber ekleyin.",
                    "Hamuru ince aÃ§Ä±p kÃ¼Ã§Ã¼k kareler kesin. Ä°Ã§ harcÄ± koyup Ã¼Ã§gen veya bohÃ§a ÅŸeklinde kapatÄ±n.",
                    "Bol tuzlu suda haÅŸlayÄ±n. YoÄŸurt ve sarÄ±msaklÄ± sos ile servis yapÄ±n.",
                    "Ãœzerine tereyaÄŸÄ±nda kÄ±zdÄ±rÄ±lmÄ±ÅŸ pul biber gezdirin."
                ]
            },
            "ezogelin Ã§orbasÄ±": {
                ingredients: [
                    { name: 'kÄ±rmÄ±zÄ± mercimek', quantity: '1 su bardaÄŸÄ±' },
                    { name: 'bulgur', quantity: '1/2 su bardaÄŸÄ±' },
                    { name: 'pirinÃ§', quantity: '2 yemek kaÅŸÄ±ÄŸÄ±' },
                    { name: 'soÄŸan', quantity: '1 adet' },
                    { name: 'salÃ§a', quantity: '1 yemek kaÅŸÄ±ÄŸÄ±' },
                    { name: 'tereyaÄŸÄ±', quantity: '50g' },
                    { name: 'nane', quantity: '1 Ã§ay kaÅŸÄ±ÄŸÄ±' },
                    { name: 'tuz', quantity: '1 Ã§ay kaÅŸÄ±ÄŸÄ±' }
                ],
                response: "ğŸ¥£ Ezogelin Ã§orbasÄ±! Geleneksel TÃ¼rk mutfaÄŸÄ±nÄ±n en sevilen Ã§orbalarÄ±ndan.",
                instructions: [
                    "Mercimek, bulgur ve pirinci yÄ±kayÄ±n.",
                    "Tencerede tereyaÄŸÄ±nda rendelenmiÅŸ soÄŸanÄ± kavurun.",
                    "SalÃ§a ekleyip kokusu Ã§Ä±kana kadar kavurun.",
                    "Mercimek, bulgur, pirinÃ§ ve su ekleyin. Tuz ve baharatlarÄ± ayarlayÄ±n.",
                    "Sebzeler yumuÅŸayana kadar piÅŸirin. BlendÄ±rdan geÃ§irin. Nane ile servis edin."
                ]
            },
            "tarhana Ã§orbasÄ±": {
                ingredients: [
                    { name: 'tarhana', quantity: '3 yemek kaÅŸÄ±ÄŸÄ±' },
                    { name: 'su', quantity: '4 su bardaÄŸÄ±' },
                    { name: 'tereyaÄŸÄ±', quantity: '50g' },
                    { name: 'tuz', quantity: '1 Ã§ay kaÅŸÄ±ÄŸÄ±' }
                ],
                response: "ğŸœ Tarhana Ã§orbasÄ±! KÄ±ÅŸ aylarÄ±nÄ±n vazgeÃ§ilmez sÄ±cacÄ±k lezzeti.",
                instructions: [
                    "TarhanayÄ± bir kasede soÄŸuk su ile ezin.",
                    "Tencerede tereyaÄŸÄ±nÄ± eritin, nane ve pul biberi kavurun.",
                    "Tarhana karÄ±ÅŸÄ±mÄ±nÄ± ve suyu ekleyip sÃ¼rekli karÄ±ÅŸtÄ±rarak kaynatÄ±n.",
                    "KÄ±sÄ±k ateÅŸte 5-10 dakika daha piÅŸirin. Servis yapÄ±n."
                ]
            },
            "domates Ã§orbasÄ±": {
                ingredients: [
                    { name: 'domates', quantity: '1 kg' },
                    { name: 'un', quantity: '2 yemek kaÅŸÄ±ÄŸÄ±' },
                    { name: 'tereyaÄŸÄ±', quantity: '50g' },
                    { name: 'sÃ¼t', quantity: '1 su bardaÄŸÄ±' },
                    { name: 'ÅŸeker', quantity: '1 Ã§ay kaÅŸÄ±ÄŸÄ±' },
                    { name: 'tuz', quantity: '1 Ã§ay kaÅŸÄ±ÄŸÄ±' }
                ],
                response: "ğŸ… Domates Ã§orbasÄ±! Ã‡ocuklarÄ±n en sevdiÄŸi hafif ve lezzetli Ã§orba.",
                instructions: [
                    "Domatesleri rendeleyin. Tencerede tereyaÄŸÄ±nÄ± eritin, un ve salÃ§ayÄ± kavurun.",
                    "RendelenmiÅŸ domatesi ekleyip karÄ±ÅŸtÄ±rÄ±n. Suyu veya sÃ¼tÃ¼ azar azar ekleyerek karÄ±ÅŸtÄ±rÄ±n.",
                    "Åeker ve tuzu ekleyip kaynamaya bÄ±rakÄ±n. Blenderdan geÃ§irip pÃ¼rÃ¼zsÃ¼z hale getirin."
                ]
            },
            "imam bayÄ±ldÄ±": {
                ingredients: [
                    { name: 'patlÄ±can', quantity: '6 adet' },
                    { name: 'soÄŸan', quantity: '3 adet' },
                    { name: 'sarÄ±msak', quantity: '4 diÅŸ' },
                    { name: 'domates', quantity: '2 adet' },
                    { name: 'maydanoz', quantity: '1 demet' },
                    { name: 'zeytinyaÄŸÄ±', quantity: '1 su bardaÄŸÄ±' }
                ],
                response: "ğŸ«’ Ä°mam BayÄ±ldÄ±! ZeytinyaÄŸlÄ± sebze yemeklerinin kralÄ±.",
                instructions: [
                    "PatlÄ±canlarÄ± alacalÄ± soyup ortadan ikiye kesin ve tuzlu suda bekletin.",
                    "SoÄŸan, sarÄ±msak, domates ve maydanozu ince ince doÄŸrayÄ±n.",
                    "Tavada zeytinyaÄŸÄ±nda soÄŸan ve sarÄ±msaÄŸÄ± kavurun. Domates ve maydanozu ekleyin.",
                    "PatlÄ±canlarÄ± sÃ¼zÃ¼p kurulayÄ±n. Ä°Ã§lerini oyup hazÄ±rladÄ±ÄŸÄ±nÄ±z harcÄ± doldurun.",
                    "Tepsiye dizip Ã¼zerine su gezdirin ve 180Â°C fÄ±rÄ±nda piÅŸirin."
                ]
            },
            "kuru fasulye": {
                ingredients: [
                    { name: 'kuru fasulye', quantity: '500g' },
                    { name: 'et', quantity: '300g' },
                    { name: 'soÄŸan', quantity: '2 adet' },
                    { name: 'domates', quantity: '2 adet' },
                    { name: 'salÃ§a', quantity: '2 yemek kaÅŸÄ±ÄŸÄ±' },
                    { name: 'zeytinyaÄŸÄ±', quantity: '3 yemek kaÅŸÄ±ÄŸÄ±' }
                ],
                response: "ğŸ«˜ Kuru fasulye! Pilav ile birlikte TÃ¼rk mutfaÄŸÄ±nÄ±n klasiÄŸi.",
                instructions: [
                    "Kuru fasulyeleri bir gece Ã¶nceden Ä±slatÄ±n ve ertesi gÃ¼n haÅŸlayÄ±n.",
                    "Tencerede zeytinyaÄŸÄ±nda etleri kavurun. SoÄŸanÄ± ekleyip pembeleÅŸene kadar kavurun.",
                    "SalÃ§a ve domatesi ekleyip karÄ±ÅŸtÄ±rÄ±n.",
                    "HaÅŸlanmÄ±ÅŸ fasulyeyi ekleyin, Ã¼zerini geÃ§ecek kadar sÄ±cak su ekleyin. Tuz ve baharatlarÄ± ayarlayÄ±n.",
                    "KÄ±sÄ±k ateÅŸte fasulyeler yumuÅŸayana kadar piÅŸirin."
                ]
            },
            "pilav": {
                ingredients: [
                    { name: 'pirinÃ§', quantity: '2 su bardaÄŸÄ±' },
                    { name: 'tereyaÄŸÄ±', quantity: '50g' },
                    { name: 'su', quantity: '3 su bardaÄŸÄ±' },
                    { name: 'tuz', quantity: '1 Ã§ay kaÅŸÄ±ÄŸÄ±' }
                ],
                response: "ğŸš Pilav! TÃ¼rk mutfaÄŸÄ±nÄ±n vazgeÃ§ilmez yan yemeÄŸi.",
                instructions: [
                    "PirinÃ§leri yÄ±kayÄ±p Ä±lÄ±k tuzlu suda 20 dakika bekletin, sonra sÃ¼zÃ¼n.",
                    "Tencerede tereyaÄŸÄ±nÄ± eritin, pirinÃ§leri ekleyip 5 dakika kavurun.",
                    "Kaynar suyu ve tuzu ekleyip karÄ±ÅŸtÄ±rÄ±n. KÄ±sÄ±k ateÅŸte suyunu Ã§ekene kadar piÅŸirin.",
                    "Ocaktan alÄ±p 10 dakika dinlendirin. Demlendikten sonra karÄ±ÅŸtÄ±rÄ±p servis edin."
                ]
            },
            "bulgur pilavÄ±": {
                ingredients: [
                    { name: 'bulgur', quantity: '2 su bardaÄŸÄ±' },
                    { name: 'soÄŸan', quantity: '1 adet' },
                    { name: 'tereyaÄŸÄ±', quantity: '50g' },
                    { name: 'su', quantity: '3 su bardaÄŸÄ±' },
                    { name: 'tuz', quantity: '1 Ã§ay kaÅŸÄ±ÄŸÄ±' }
                ],
                response: "ğŸŒ¾ Bulgur pilavÄ±! SaÄŸlÄ±klÄ± ve doyurucu bir alternatif.",
                instructions: [
                    "SoÄŸanÄ± ince doÄŸrayÄ±n. TereyaÄŸÄ±nda pembeleÅŸene kadar kavurun.",
                    "Bulguru ekleyip 2-3 dakika daha kavurun.",
                    "Suyu ve tuzu ekleyip kÄ±sÄ±k ateÅŸte bulgur suyunu Ã§ekene kadar piÅŸirin.",
                    "Demlenmeye bÄ±rakÄ±n, ardÄ±ndan servis edin."
                ]
            },
            "kÄ±sÄ±r": {
                ingredients: [
                    { name: 'ince bulgur', quantity: '2 su bardaÄŸÄ±' },
                    { name: 'domates', quantity: '3 adet' },
                    { name: 'salatalÄ±k', quantity: '2 adet' },
                    { name: 'maydanoz', quantity: '1 demet' },
                    { name: 'nane', quantity: '1/2 demet' },
                    { name: 'limon', quantity: '2 adet' },
                    { name: 'zeytinyaÄŸÄ±', quantity: '4 yemek kaÅŸÄ±ÄŸÄ±' }
                ],
                response: "ğŸ¥— KÄ±sÄ±r! Hafif ve ferahlatÄ±cÄ± TÃ¼rk salatasÄ±.",
                instructions: [
                    "Ä°nce bulguru bir kaba alÄ±n, Ã¼zerini geÃ§meyecek kadar sÄ±cak su ekleyip ÅŸiÅŸmeye bÄ±rakÄ±n.",
                    "Domates, salatalÄ±k, maydanoz ve naneyi ince ince doÄŸrayÄ±n.",
                    "ÅiÅŸen bulgura doÄŸranmÄ±ÅŸ malzemeleri, limon suyunu, zeytinyaÄŸÄ±nÄ±, salÃ§ayÄ± ve baharatlarÄ± ekleyip iyice karÄ±ÅŸtÄ±rÄ±n."
                ]
            },
            "Ã§oban salata": {
                ingredients: [
                    { name: 'domates', quantity: '4 adet' },
                    { name: 'salatalÄ±k', quantity: '2 adet' },
                    { name: 'soÄŸan', quantity: '1 adet' },
                    { name: 'biber', quantity: '2 adet' },
                    { name: 'maydanoz', quantity: '1 demet' },
                    { name: 'limon', quantity: '1 adet' },
                    { name: 'zeytinyaÄŸÄ±', quantity: '3 yemek kaÅŸÄ±ÄŸÄ±' }
                ],
                response: "ğŸ¥— Ã‡oban salata! Taze ve vitamin dolu klasik salata.",
                instructions: [
                    "TÃ¼m sebzeleri kÃ¼Ã§Ã¼k kÃ¼pler halinde doÄŸrayÄ±n.",
                    "DoÄŸradÄ±ÄŸÄ±nÄ±z tÃ¼m malzemeleri geniÅŸ bir kasede birleÅŸtirin.",
                    "Ãœzerine taze sÄ±kÄ±lmÄ±ÅŸ limon suyu, zeytinyaÄŸÄ± ve tuz gezdirin. Ä°yice karÄ±ÅŸtÄ±rÄ±p servis edin."
                ]
            },
            "mÃ¼cver": {
                ingredients: [
                    { name: 'kabak', quantity: '3 adet' },
                    { name: 'yumurta', quantity: '2 adet' },
                    { name: 'un', quantity: '3 yemek kaÅŸÄ±ÄŸÄ±' },
                    { name: 'dereotu', quantity: '1 demet' },
                    { name: 'soÄŸan', quantity: '1 adet' },
                    { name: 'tuz', quantity: '1 Ã§ay kaÅŸÄ±ÄŸÄ±' }
                ],
                response: "ğŸ¥¬ Kabak mÃ¼cveri! Sebze sevmeyenlerin bile bayÄ±lacaÄŸÄ± lezzet.",
                instructions: [
                    "KabaklarÄ± rendeleyip suyunu sÄ±kÄ±n. SoÄŸanÄ± ve dereotunu ince doÄŸrayÄ±n.",
                    "Bir kapta rendelenmiÅŸ kabak, soÄŸan, dereotu, yumurta, un ve tuzu karÄ±ÅŸtÄ±rÄ±n.",
                    "Tavada az yaÄŸda veya fÄ±rÄ±nda mÃ¼cverleri kÄ±zarana kadar piÅŸirin."
                ]
            }, 
            "lahmacun": {
                ingredients: [
                    { name: 'un', quantity: '500g' },
                    { name: 'kÄ±yma', quantity: '300g' },
                    { name: 'soÄŸan', quantity: '2 adet' },
                    { name: 'domates', quantity: '2 adet' },
                    { name: 'biber', quantity: '1 adet' },
                    { name: 'maydanoz', quantity: '1 demet' },
                    { name: 'baharat karÄ±ÅŸÄ±mÄ±', quantity: '1 Ã§ay kaÅŸÄ±ÄŸÄ±' }
                ],
                response: "ğŸ«“ Lahmacun! TÃ¼rk pizzasÄ± olarak bilinen enfes lezzet.",
                instructions: [
                    "Hamur iÃ§in un, su, tuz ve maya ile yumuÅŸak bir hamur yoÄŸurun. Dinlendirin.",
                    "Ä°Ã§ harÃ§ iÃ§in kÄ±yma, rendelenmiÅŸ soÄŸan, domates, biber, maydanoz ve baharatlarÄ± karÄ±ÅŸtÄ±rÄ±n.",
                    "Hamurdan bezeler yapÄ±p ince aÃ§Ä±n. Ãœzerine harcÄ± yayÄ±n.",
                    "Ã–nceden Ä±sÄ±tÄ±lmÄ±ÅŸ fÄ±rÄ±nda veya sacda kÄ±zarana kadar piÅŸirin."
                ]
            },
            "bÃ¶rek": {
                ingredients: [
                    { name: 'yufka', quantity: '10 adet' },
                    { name: 'peynir', quantity: '400g' },
                    { name: 'yumurta', quantity: '3 adet' },
                    { name: 'sÃ¼t', quantity: '2 su bardaÄŸÄ±' },
                    { name: 'zeytinyaÄŸÄ±', quantity: '1/2 su bardaÄŸÄ±' }
                ],
                response: "ğŸ¥§ Su bÃ¶reÄŸi! TÃ¼rk mutfaÄŸÄ±nÄ±n en sevilen hamur iÅŸi.",
                instructions: [
                    "Bir sos tenceresinde sÃ¼t, zeytinyaÄŸÄ± ve yumurtalarÄ± Ã§Ä±rpÄ±n. ",
                    "YufkalarÄ±n arasÄ±na bu karÄ±ÅŸÄ±mÄ± sÃ¼rerek kat kat dizin. Peynirli harcÄ± arasÄ±na serin.",
                    "Ã–nceden Ä±sÄ±tÄ±lmÄ±ÅŸ fÄ±rÄ±nda Ã¼zeri kÄ±zarana kadar piÅŸirin."
                ]
            },
            "gÃ¶zleme": {
                ingredients: [
                    { name: 'un', quantity: '3 su bardaÄŸÄ±' },
                    { name: 'su', quantity: '1 su bardaÄŸÄ±' },
                    { name: 'tuz', quantity: '1 Ã§ay kaÅŸÄ±ÄŸÄ±' },
                    { name: 'peynir', quantity: '200g' },
                    { name: 'Ä±spanak', quantity: '500g' },
                    { name: 'tereyaÄŸÄ±', quantity: '100g' }
                ],
                response: "ğŸ«“ GÃ¶zleme! KÃ¶y kahvaltÄ±larÄ±nÄ±n vazgeÃ§ilmez lezzeti.",
                instructions: [
                    "Hamur iÃ§in un, su ve tuzu yoÄŸurun. Dinlendirin.",
                    "Ä°Ã§ harÃ§ iÃ§in peyniri ezin, Ä±spanaÄŸÄ± doÄŸrayÄ±p karÄ±ÅŸtÄ±rÄ±n.",
                    "Hamurdan bezeler aÃ§Ä±p iÃ§ harcÄ± yerleÅŸtirin ve katlayÄ±n.",
                    "Sacda veya tavada tereyaÄŸÄ± ile arkalÄ± Ã¶nlÃ¼ kÄ±zarana kadar piÅŸirin."
                ]
            },
            "tavuk ÅŸiÅŸ": {
                ingredients: [
                    { name: 'tavuk', quantity: '1 kg' },
                    { name: 'soÄŸan', quantity: '2 adet' },
                    { name: 'biber', quantity: '3 adet' },
                    { name: 'zeytinyaÄŸÄ±', quantity: '3 yemek kaÅŸÄ±ÄŸÄ±' },
                    { name: 'baharat karÄ±ÅŸÄ±mÄ±', quantity: '1 Ã§ay kaÅŸÄ±ÄŸÄ±' }
                ],
                response: "ğŸ— Tavuk ÅŸiÅŸ! MangalÄ±n en saÄŸlÄ±klÄ± seÃ§eneÄŸi.",
                instructions: [
                    "Tavuk etini kÃ¼p kÃ¼p doÄŸrayÄ±n. SoÄŸan ve biberi de doÄŸrayÄ±n.",
                    "Tavuk etlerini zeytinyaÄŸÄ± ve baharatlarla marine edin.",
                    "ÅiÅŸlere tavuk ve sebzeleri sÄ±rayla dizin.",
                    "Mangalda veya Ä±zgarada tavuklar kÄ±zarana kadar piÅŸirin."
                ]
            },
            "Ä±zgara balÄ±k": {
                ingredients: [
                    { name: 'balÄ±k', quantity: '1 kg' },
                    { name: 'limon', quantity: '2 adet' },
                    { name: 'zeytinyaÄŸÄ±', quantity: '3 yemek kaÅŸÄ±ÄŸÄ±' },
                    { name: 'tuz', quantity: '1 Ã§ay kaÅŸÄ±ÄŸÄ±' },
                    { name: 'karabiber', quantity: '1 Ã§ay kaÅŸÄ±ÄŸÄ±' }
                ],
                response: "ğŸŸ Izgara balÄ±k! Omega-3 aÃ§Ä±sÄ±ndan zengin saÄŸlÄ±klÄ± seÃ§im.",
                instructions: [
                    "BalÄ±ÄŸÄ± temizleyip yÄ±kayÄ±n ve kaÄŸÄ±t havlu ile kurulayÄ±n.",
                    "ZeytinyaÄŸÄ±, limon suyu, tuz ve karabiber ile marine edin.",
                    "Izgarada veya tavada balÄ±klarÄ± her iki tarafÄ± da kÄ±zarana kadar piÅŸirin.",
                    "YanÄ±nda yeÅŸil salata ile servis yapÄ±n."
                ]
            }
        };

        const emojiMap = {
            'domates': 'ğŸ…', 'salatalÄ±k': 'ğŸ¥’', 'elma': 'ğŸ', 'muz': 'ğŸŒ', 'patates': 'ğŸ¥”',
            'soÄŸan': 'ğŸ§…', 'marul': 'ğŸ¥¬', 'limon': 'ğŸ‹', 'havuÃ§': 'ğŸ¥•', 'biber': 'ğŸŒ¶ï¸',
            'patlÄ±can': 'ï¿½', 'kabak': 'ğŸ¥’', 'tavuk': 'ğŸ—', 'dana eti': 'ğŸ¥©', 'balÄ±k': 'ğŸŸ',
            'sÃ¼t': 'ğŸ¥›', 'yoÄŸurt': 'ğŸ¥›', 'peynir': 'ğŸ§€', 'yumurta': 'ğŸ¥š', 'ekmek': 'ğŸ',
            'pirinÃ§': 'ğŸš', 'makarna': 'ğŸ', 'un': 'ğŸŒ¾', 'ÅŸeker': 'ğŸ¯', 'tuz': 'ğŸ§‚',
            'zeytinyaÄŸÄ±': 'ğŸŒ¿', 'zeytin': 'ğŸ‡', 'su': 'ğŸ’§', 'deterjan': 'ğŸ§´', 'sabun': 'ğŸ§¼',
            'bal': 'ğŸ¯', 'badem': 'ğŸ¥œ', 'ceviz': 'ğŸ¥œ', 'fÄ±ndÄ±k': 'ğŸ¥œ', 'Ã§ikolata': 'ğŸ«',
            'Ã§ay': 'â˜•', 'kahve': 'â˜•', 'Ã§ilek': 'ğŸ“', 'kiraz': 'ğŸ’', 'Ã¼zÃ¼m': 'ğŸ‡'
        };

        // AkÄ±llÄ± ÃœrÃ¼n Ã–neri VeritabanÄ±
        const productDatabase = [
            'ğŸ¥‘ Avokado', 'ğŸ Amasya ElmasÄ±', 'ğŸŒ° Antep FÄ±stÄ±ÄŸÄ±', 'ğŸ¥› Ayran', 'ğŸŒ» Ay Ã‡ekirdeÄŸi', 
            'ğŸŒ¾ Arpa', 'ğŸŒ¶ï¸ AcÄ± Biber', 'ğŸ¯ Akasya BalÄ±', 'ğŸ§… ArpacÄ±k SoÄŸanÄ±', 'ğŸ¥¬ Arugula', 
            'ğŸŒ¾ Amarant', 'ğŸ¥œ Antep FÄ±stÄ±ÄŸÄ± Ezmesi',
            'ğŸ¥œ Badem', 'ğŸ¯ Bal', 'ğŸŸ BalÄ±k', 'ğŸŒ¾ Barbunya', 'ğŸŒ¶ï¸ Biber', 'ğŸ¥¦ Brokoli', 
            'ğŸŒ¾ Bulgur', 'ğŸª BiskÃ¼vi', 'ğŸ§€ Beyaz Peynir', 'ğŸ¥– Baget', 'ğŸ‡ BÃ¶ÄŸÃ¼rtlen', 
            'ğŸ¥© Bonfile', 'ğŸº Bira', 'ğŸ¥¬ BrÃ¼ksel LahanasÄ±', 'ğŸŒ¶ï¸ Biber SalÃ§asÄ±', 'ğŸ§ˆ Butter', 
            'ğŸ¥¨ Bagel', 'ğŸŒ Banana Chips', 'ğŸ¥© Beefsteak', 'ğŸ§€ Brie Peyniri', 'ğŸ¥– Brioche', 'ğŸŒ¾ BuÄŸday',
            'ğŸ¥œ Ceviz', 'ğŸ¥¨ Cips', 'ğŸ’ Cherry', 'ğŸ§€ Cheddar', 'ğŸ§€ Camembert', 'ğŸŒ¶ï¸ Chili', 
            'ğŸ« Cocoa', 'â˜• Cappuccino', 'ğŸ¥’ Cornichon', 'ğŸ¥¥ Coconut',
            'ğŸ’ Ã‡ilek', 'ğŸ« Ã‡ikolata', 'â˜• Ã‡ay', 'ğŸ“ Ã‡ilek ReÃ§eli', 'ğŸ« Ã‡ikolatalÄ± BiskÃ¼vi', 
            'ğŸŒ¿ Ã‡emen', 'ğŸ§€ Ã‡Ã¶kelek', 'ğŸŒ² Ã‡am FÄ±stÄ±ÄŸÄ±', 'ğŸŒ¾ Ã‡avdar', 'ğŸ² Ã‡orba', 'ğŸ“ Ã‡ilek MarmelatÄ±',
            'ğŸ¥© Dana Eti', 'ğŸŒ¿ Dereotu', 'ğŸ§´ Deterjan', 'ğŸª¥ DiÅŸ Macunu', 'ğŸ© Donut', 'ğŸ… Domates', 
            'ğŸ¦ Dondurma', 'ğŸ… Domates SalÃ§asÄ±', 'ğŸŒ¿ Defne YapraÄŸÄ±', 'ğŸ‡ Dut', 'ğŸ¥© DÃ¶ner', 
            'ğŸ Dilim Ekmek', 'ğŸ§€ Dil Peyniri', 'ğŸ¥› Demirhindi',
            'ğŸ Ekmek', 'ğŸ Elma', 'ğŸ¥¬ Enginar', 'ğŸ‘ Erik', 'ğŸ¥š Yumurta', 'ğŸ§€ Ezine Peyniri',
            'ğŸ Elma Suyu', 'ğŸ Elma Sirkesi', 'ğŸŒ¿ Estragon', 'ğŸ¥¬ EbegÃ¼meci', 'ğŸ‡ EkÅŸi ÃœzÃ¼m',
            'ğŸ Esmer Ekmek', 'ğŸ§€ Emmental', 'â˜• Espresso', 'ğŸ EriÅŸte',
            'ğŸ¥œ FÄ±ndÄ±k', 'ğŸ¥œ FÄ±stÄ±k', 'ğŸŒ¾ Fasulye', 'ğŸŸ Fener BalÄ±ÄŸÄ±', 'ğŸ‡ Fig',
            'ğŸ¥œ FÄ±ndÄ±k Ezmesi', 'ğŸŒ¾ Fasulye Pilaki', 'ğŸ Focaccia', 'ğŸ§€ Feta', 'ğŸ“ Frambuaz',
            'ğŸ¥› Frappuccino', 'ğŸŸ French Fries', 'ğŸ¥– French Bread',
            'ğŸ¥¨ Galeta', 'ğŸŠ Greyfurt', 'ğŸ§€ Gouda', 'ğŸ¥› Greek Yogurt', 'ğŸŒ¹ GÃ¼l YapraÄŸÄ±', 
            'ğŸ¯ GÃ¼l BalÄ±', 'ğŸ¥’ Gurme TurÅŸu', 'ğŸ¥¤ Gazoz', 'ğŸ¥£ Granola', 'ğŸ§€ Gruyere', 
            'ğŸ‡ Grape Juice', 'ğŸ«š Ginger',
            'ğŸ¥• HavuÃ§', 'ğŸ¦ƒ Hindi', 'ğŸŒ° Hurma', 'ğŸ¥’ HÄ±yar', 'ğŸŒ­ Hardal', 'ğŸ¥› Hazelnut Milk', 
            'ğŸ¯ Heather Honey', 'ğŸ§€ Halloumi', 'ğŸŒº Hibiscus', 'ğŸ¥• HavuÃ§ Suyu', 'ğŸ¦ƒ Hindi GÃ¶ÄŸsÃ¼', 
            'ğŸŒ° Hurma Ezmesi', 'â˜• Hot Chocolate',
            'ğŸ¥¬ Ispanak', 'ğŸ‡ Ä°ncir', 'ğŸ§Š Iced Tea', 'ğŸ¦ Ice Cream', 'ğŸŒ¿ Italian Herbs',
            'ğŸ§€ Ä°zmir Tulum', 'ğŸ‡ Ä°ncir ReÃ§eli', 'ğŸ¥› Ä°rmik', 'ğŸŒ¿ Ä°talyan BaharatÄ±', 'ğŸ Ä°talyan EkmeÄŸi',
            'ğŸ§Š Jel', 'ğŸ‡ Jelly', 'ğŸ§ƒ Juice', 'ğŸŒ¶ï¸ Jalapeno', 'ğŸ¯ Jam',
            'â˜• Kahve', 'ğŸ¥’ Kabak', 'ğŸ§€ KaÅŸar', 'ğŸ¥œ Kaju', 'ğŸ‰ Karpuz', 'ğŸ’ Kiraz', 'ğŸ¥© KÄ±yma', 
            'ğŸ¥¥ Hindistan Cevizi', 'ğŸ§€ Krem Peynir', 'ğŸª Kurabiye', 'ğŸ¥œ KuruyemiÅŸ', 'ğŸŒ¶ï¸ Kimyon',
            'ğŸ¥¬ KÄ±vÄ±rcÄ±k', 'ğŸ‹ KireÃ§', 'ğŸ§€ KaÅŸkaval', 'ğŸ‘ Kuzu Eti', 'ğŸ’ Kiraz ReÃ§eli', 
            'ğŸ¥› Kefir', 'ğŸŒ¾ Kinoa', 'ğŸ¥’ KorniÅŸon', 'ğŸª Kraker', 'ğŸ§€ Krem Åanti', 
            'ğŸ« Kakao', 'ğŸŒ¿ Kekik', 'ğŸŒ¿ Kapari',
            'ğŸ‹ Limon', 'ğŸ§€ Lor Peyniri', 'ğŸ¥¬ Lahana', 'ğŸ‹ Limon Suyu', 'ğŸ§€ Labne',
            'â˜• Latte', 'ğŸ¥¬ Leek', 'ğŸ‹ Lime', 'ğŸ§€ Limburger', 'ğŸ¯ Lavanta BalÄ±',
            'ğŸ Makarna', 'ğŸˆ Kavun', 'ğŸ¥› SÃ¼t', 'ğŸ„ Mantar', 'ğŸ¥­ Mango', 'ğŸŒ¿ Maydanoz', 
            'ğŸŒ½ MÄ±sÄ±r', 'ğŸ§€ Mozzarella', 'ğŸŒ Muz', 'ğŸ¥› Milkshake', 'ğŸ¯ Manuka BalÄ±', 
            'ğŸ¥œ Macadamia', 'ğŸˆ Melon', 'ğŸ§€ Mascarpone', 'ğŸµ Matcha', 'ğŸŒ¿ Mint', 
            'ğŸ– Meatball', 'ğŸ Macaroni', 'â˜• Mocha', 'ğŸ§€ Muenster', 'ğŸ„ Morel MantarÄ±', 'ğŸ¥­ Mango Suyu',

            'ğŸŒ¾ Nohut', 'ğŸŒ¿ Nane', 'ğŸ‡ Nar', 'ğŸ« Nutella', 'ğŸ¥œ Nut Mix', 'ğŸ‡ Nar EkÅŸisi', 
            'ğŸŒ¿ Nane YapraÄŸÄ±', 'ğŸ§€ Neufchatel', 'ğŸ« Nesquik',
            'ğŸ¹Oralet', 'ğŸªOreo', 'ğŸŸOrkinos', 'ğŸ”¥Ocak Ã‡akmaÄŸÄ±', 'ğŸ’… Oje',
            'ğŸ¦† Ã–rdek', 'ğŸ§€Ã–rgÃ¼ Peyniri', 'ğŸ‘©â€ğŸ³Ã–nlÃ¼k', 'ğŸŒ¶ï¸ Ã–ÄŸÃ¼tÃ¼lmÃ¼ÅŸ Karabiber', 'ğŸ¥› Ã–zel SÃ¼t',
            'ğŸ¥” Patates', 'ğŸ§€ Peynir', 'ğŸ‘ Åeftali', 'ğŸ¥ Pankek', 'ğŸ• Pizza', 'ğŸŠ Portakal', 
            'ğŸ¿ PatlamÄ±ÅŸ MÄ±sÄ±r', 'ğŸ§€ Parmesan', 'ğŸŒ¿ Parsley', 'ğŸ¥¤ Protein Shake', 'ğŸ‘ Peach', 
            'ğŸ¥œ Peanut', 'ğŸ Pear', 'ğŸŒ¶ï¸ Paprika', 'ğŸ• Pepperoni', 'ğŸ¥ Pancake Mix', 
            'ğŸ§€ Provolone', 'ğŸ‡ Plum', 'ğŸ® Pudding',
            'ğŸ“ ReÃ§el', 'ğŸš PirinÃ§', 'ğŸ¥¬ Roka', 'ğŸ‡ Raisin', 'ğŸ§€ Ricotta', 'ğŸŒ¿ Rosemary', 
            'ğŸ¥› Rice Milk', 'ğŸ“ Raspberry', 'ğŸ Rye Bread',
            'ğŸ§‚ Tuz', 'ğŸ¥› SÃ¼t', 'ğŸŒ­ Sosis', 'ğŸ¥© Salam', 'ğŸ§„ SarÄ±msak', 'ğŸ¥’ SalatalÄ±k', 
            'ğŸŒ» Susam', 'ğŸ¥© Sucuk', 'ğŸ’§ Su', 'ğŸ“ Strawberry', 'ğŸ§€ Swiss Cheese', 'ğŸ¥› Soy Milk', 
            'ğŸŒ¿ Sage', 'ğŸ¯ Sunflower Honey', 'ğŸ¥œ Sunflower Seeds', 'ğŸ¥› Smoothie', 'ğŸ§€ Stilton', 
            'ğŸŒ¶ï¸ Sriracha', 'ğŸ¥¤ Soda', 'ğŸ Spaghetti',
            'ğŸ‘ Åeftali', 'ğŸ¯ Åeker', 'ğŸ¯ Åeker PancarÄ±', 'ğŸ¥› Åekersiz SÃ¼t', 'ğŸŒ¿ ÅerbetÃ§iotu',
            'ğŸ§€ Åavak Peyniri', 'ğŸ‡ ÅÄ±ra', 'ğŸ¥¤ Åalgam',
            'ğŸ— Tavuk', 'ğŸ§ˆ TereyaÄŸÄ±', 'ğŸ§» Tuvalet KaÄŸÄ±dÄ±', 'ğŸ¥œ Tahin', 'ğŸ… Domates', 'ğŸ§‚ Tuz', 
            'ğŸŒ¿ Thyme', 'ğŸ§€ Tilsit', 'ğŸµ Tea', 'ğŸ… Tomato Sauce', 'ğŸ¦ƒ Turkey', 'ğŸ¥œ Tahini', 
            'ğŸŒ¿ Turmeric', 'ğŸ§€ Tulum Peyniri', 'ğŸ¥¤ Tonic Water',
            'ğŸŒ¾ Un', 'ğŸ‡ ÃœzÃ¼m', 'ğŸ¥› UHT Milk', 'ğŸŒ¿ Umami Sauce', 'ğŸ‡ ÃœzÃ¼m Suyu',
            'ğŸ’ ViÅŸne', 'ğŸ§€ Velveeta', 'ğŸŒ¿ Vanilla Extract', 'ğŸ’ ViÅŸne Suyu', 'ğŸ¥› Vitamin Water',
            'ğŸ‰ Watermelon', 'ğŸ¥› Whey Protein', 'ğŸŒ¾ Wheat', 'ğŸ§€ White Cheese',
            'ğŸ¥š Yumurta', 'ğŸ¥› YoÄŸurt', 'ğŸŒ¾ Yulaf', 'ğŸ§ˆ YaÄŸ', 'ğŸ‡ Yaban Mersini', 'ğŸ¥› Yakult', 
            'ğŸ§€ Yak Peyniri', 'ğŸµ YeÅŸil Ã‡ay', 'ğŸ¥œ Yer FÄ±stÄ±ÄŸÄ±', 'ğŸ¥› Yogurt Drink', 'ğŸŒ¾ Yeast', 'ğŸ  Yam',
            'ğŸ‡ Zeytin', 'ğŸŒ¿ ZeytinyaÄŸÄ±', 'ğŸ«š Zencefil', 'ğŸ§€ ZÃ¼rih Peyniri', 'ğŸ¥¤ Zero Calorie Drink', 
            'ğŸŒ¶ï¸ Zatar', 'ğŸ‹ Zest'
        ].filter((item, index, self) => {
            const cleanItem = item.replace(/^[^\w\s]+\s*/, '').toLowerCase();
            return index === self.findIndex(t => t.replace(/^[^\w\s]+\s*/, '').toLowerCase() === cleanItem);
        }).sort((a, b) => {
            const cleanA = a.replace(/^[^\w\s]+\s*/, '').toLowerCase();
            const cleanB = b.replace(/^[^\w\s]+\s*/, '').toLowerCase();
            return cleanA.localeCompare(cleanB, 'tr');
        });

        // Emoji Haritalama Fonksiyonu
        function getItemEmoji(item) {
            const itemLower = item.toLowerCase().trim();
            
            if (emojiMap[itemLower]) {
                return emojiMap[itemLower];
            }
            
            if (itemLower === 'bal') return 'ğŸ¯';
            if (itemLower === 'balÄ±k') return 'ğŸŸ';
            if (itemLower === 'badem') return 'ğŸ¥œ';
            if (itemLower === 'barbunya') return 'ğŸŒ¾';
            
            if (itemLower.includes('balÄ±k')) return 'ğŸŸ';
            if (itemLower.includes('bal') && !itemLower.includes('balÄ±k')) return 'ğŸ¯';
            
            if (itemLower.includes('domates')) return 'ğŸ…';
            if (itemLower.includes('elma')) return 'ğŸ';
            if (itemLower.includes('muz')) return 'ğŸŒ';
            if (itemLower.includes('portakal')) return 'ğŸŠ';
            if (itemLower.includes('limon')) return 'ğŸ‹';
            if (itemLower.includes('Ã¼zÃ¼m')) return 'ğŸ‡';
            if (itemLower.includes('Ã§ilek')) return 'ğŸ“';
            if (itemLower.includes('kiraz')) return 'ğŸ’';
            if (itemLower.includes('ÅŸeftali') || itemLower.includes('erik')) return 'ğŸ‘';
            if (itemLower.includes('avokado')) return 'ğŸ¥‘';
            if (itemLower.includes('karpuz')) return 'ğŸ‰';
            if (itemLower.includes('kavun')) return 'ğŸˆ';
            if (itemLower.includes('ananas')) return 'ğŸ';
            if (itemLower.includes('kivi')) return 'ğŸ¥';
            if (itemLower.includes('mango')) return 'ğŸ¥­';
            if (itemLower.includes('salatalÄ±k') || itemLower.includes('hÄ±yar')) return 'ğŸ¥’';
            if (itemLower.includes('havuÃ§')) return 'ğŸ¥•';
            if (itemLower.includes('patates')) return 'ğŸ¥”';
            if (itemLower.includes('soÄŸan')) return 'ğŸ§…';
            if (itemLower.includes('sarÄ±msak')) return 'ğŸ§„';
            if (itemLower.includes('biber')) return 'ğŸŒ¶ï¸';
            if (itemLower.includes('patlÄ±can')) return 'ğŸ†';
            if (itemLower.includes('brokoli')) return 'ğŸ¥¦';
            if (itemLower.includes('lahana') || itemLower.includes('ispanak') || itemLower.includes('marul')) return 'ğŸ¥¬';
            if (itemLower.includes('mantar')) return 'ğŸ„';
            if (itemLower.includes('mÄ±sÄ±r')) return 'ğŸŒ½';
            
            if (itemLower.includes('tavuk')) return 'ğŸ—';
            if (itemLower.includes('et') || itemLower.includes('dana') || itemLower.includes('kuzu')) return 'ğŸ¥©';
            if (itemLower.includes('kÄ±yma')) return 'ğŸ¥©';
            if (itemLower.includes('sucuk') || itemLower.includes('sosis') || itemLower.includes('salam')) return 'ğŸŒ­';
            if (itemLower.includes('sÃ¼t')) return 'ğŸ¥›';
            if (itemLower.includes('yoÄŸurt') || itemLower.includes('ayran')) return 'ğŸ¥›';
            if (itemLower.includes('peynir')) return 'ğŸ§€';
            if (itemLower.includes('yumurta')) return 'ğŸ¥š';
            if (itemLower.includes('tereyaÄŸÄ±') || itemLower.includes('margarin')) return 'ğŸ§ˆ';
            
            if (itemLower.includes('ekmek')) return 'ğŸ';
            if (itemLower.includes('pirinÃ§')) return 'ğŸš';
            if (itemLower.includes('makarna')) return 'ğŸ';
            if (itemLower.includes('bulgur') || itemLower.includes('mercimek') || itemLower.includes('nohut')) return 'ğŸŒ¾';
            if (itemLower.includes('fasulye') || itemLower.includes('barbunya')) return 'ğŸŒ¾';
            if (itemLower.includes('un')) return 'ğŸŒ¾';
            
            if (itemLower.includes('fÄ±ndÄ±k') || itemLower.includes('ceviz') || itemLower.includes('badem')) return 'ğŸ¥œ';
            if (itemLower.includes('fÄ±stÄ±k')) return 'ğŸ¥œ';
            
            if (itemLower.includes('su')) return 'ğŸ’§';
            if (itemLower.includes('Ã§ay')) return 'â˜•';
            if (itemLower.includes('kahve')) return 'â˜•';
            if (itemLower.includes('kola') || itemLower.includes('gazoz')) return 'ğŸ¥¤';
            if (itemLower.includes('meyve suyu') || itemLower.includes('suyu')) return 'ğŸ§ƒ';
            
            if (itemLower.includes('Ã§ikolata')) return 'ğŸ«';
            if (itemLower.includes('ÅŸeker')) return 'ğŸ¯';
            if (itemLower.includes('biskÃ¼vi') || itemLower.includes('kurabiye')) return 'ğŸª';
            if (itemLower.includes('cips')) return 'ğŸ¥¨';
            
            if (itemLower.includes('deterjan') || itemLower.includes('sabun')) return 'ğŸ§´';
            if (itemLower.includes('ÅŸampuan')) return 'ğŸ§´';
            if (itemLower.includes('diÅŸ macunu')) return 'ğŸª¥';
            if (itemLower.includes('tuvalet kaÄŸÄ±dÄ±') || itemLower.includes('kaÄŸÄ±t havlu')) return 'ğŸ§»';
            
            if (itemLower.includes('tuz')) return 'ğŸ§‚';
            if (itemLower.includes('karabiber') || itemLower.includes('baharat')) return 'ğŸŒ¶ï¸';
            if (itemLower.includes('nane') || itemLower.includes('maydanoz') || itemLower.includes('dereotu')) return 'ğŸŒ¿';
            
            if (itemLower.includes('zeytinyaÄŸÄ±') || itemLower.includes('yaÄŸ')) return 'ğŸŒ¿';
            if (itemLower.includes('zeytin')) return 'ğŸ‡';
            
            return 'ğŸ›’';
        }

        // Save to localStorage
        function saveToStorage() {
            localStorage.setItem('akilliMarket_shoppingList', JSON.stringify(appState.shoppingList));
            localStorage.setItem('akilliMarket_settings', JSON.stringify(appState.settings));
            localStorage.setItem('akilliMarket_chefName', appState.chefName);
            localStorage.setItem('akilliMarket_sharedUsers', JSON.stringify(appState.sharedUsers));
            localStorage.setItem('akilliMarket_shareCode', appState.shareCode);
        }

        // Notification System
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            
            notificationText.textContent = message;
            
            // Remove previous type classes
            notification.classList.remove('notification-success', 'notification-error', 'notification-info');
            notification.classList.add(`notification-${type}`);

            // Apply styles based on type (CSS variables are now used more directly)
            if (type === 'success') {
                notification.style.background = 'var(--card-background)';
                notification.style.color = 'var(--text-color)';
            } else if (type === 'error') {
                notification.style.background = '#FEE2E2'; // Light red for error background
                notification.style.color = '#DC2626';     // Dark red for error text
            } else { // info
                notification.style.background = 'var(--card-background)';
                notification.style.color = 'var(--primary-color)';
            }

            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }

        // Update state and re-render
        function updateState(newState) {
            appState = { ...appState, ...newState };
            saveToStorage();
            render();
        }

        // Event handlers
        function handleLogin(username) {
            updateState({
                user: { 
                    name: username, 
                    id: Date.now(),
                    trustScore: 85
                }
            });
            showNotification(`HoÅŸ geldin ${username}! ğŸ‰`);
        }

        // Kategorileme fonksiyonu
        function categorizeItem(itemName) {
            const name = itemName.toLowerCase().trim();
            const categories = {
                'Meyve & Sebze': ['elma', 'armut', 'muz', 'portakal', 'limon', 'mandalina', 'Ã¼zÃ¼m', 'Ã§ilek', 'kiraz', 'ÅŸeftali', 'domates', 'salatalÄ±k', 'soÄŸan', 'sarÄ±msak', 'patates', 'havuÃ§', 'kabak', 'patlÄ±can', 'biber', 'marul', 'roka', 'maydanoz', 'dereotu', 'nane', 'fesleÄŸen', 'avokado', 'ananas', 'kivi', 'lahana', 'karnabahar', 'brokoli', 'ispanak', 'semizotu', 'bamya', 'fasulye', 'bezelye'],
                'Et & Tavuk': ['et', 'dana', 'kuzu', 'koyun', 'tavuk', 'hindi', 'balÄ±k', 'ton', 'somon', 'levrek', 'kÃ¶fte', 'sucuk', 'salam', 'jambon', 'pastÄ±rma', 'karides', 'midye', 'ahtapot'],
                'SÃ¼t ÃœrÃ¼nleri': ['sÃ¼t', 'yoÄŸurt', 'peynir', 'kaÅŸar', 'beyaz peynir', 'tulum', 'lor', 'krema', 'tereyaÄŸÄ±', 'margarin', 'ayran', 'kefir', 'labne', 'ricotta', 'mozzarella', 'kaÅŸkaval'],
                'Unlu Mamuller': ['ekmek', 'somun', 'francala', 'pide', 'simit', 'poÄŸaÃ§a', 'bÃ¶rek', 'makarna', 'spagetti', 'eriÅŸte', 'bulgur', 'pirinÃ§', 'un', 'maya', 'galeta', 'biskÃ¼vi', 'kraker'],
                'Ä°Ã§ecek': ['su', 'Ã§ay', 'kahve', 'kola', 'fanta', 'sprite', 'meyve suyu', 'ÅŸarap', 'bira', 'gazoz', 'soda', 'ayran', 'smoothie', 'enerji iÃ§eceÄŸi', 'limonata'],
                'Temizlik': ['deterjan', 'sabun', 'ÅŸampuan', 'diÅŸ macunu', 'temizlik', 'Ã§amaÅŸÄ±r', 'bulaÅŸÄ±k', 'kaÄŸÄ±t havlu', 'tuvalet kaÄŸÄ±dÄ±', 'mendil', 'Ã§Ã¶p poÅŸeti', 'sÃ¼nger'],
                'Bakliyat': ['nohut', 'mercimek', 'fasulye', 'barbunya', 'bÃ¶rÃ¼lce', 'bezelye', 'bakla', 'soya'],
                'Baharat': ['tuz', 'karabiber', 'kÄ±rmÄ±zÄ± biber', 'kimyon', 'nane', 'kekik', 'defne', 'tarÃ§Ä±n', 'karanfil', 'baharat', 'curry', 'zerdeÃ§al', 'sumak'],
                'AtÄ±ÅŸtÄ±rmalÄ±k': ['cips', 'Ã§ikolata', 'gofret', 'kek', 'kurabiye', 'kraker', 'Ã§erez', 'fÄ±ndÄ±k', 'fÄ±stÄ±k', 'badem', 'ceviz', 'dondurma', 'ÅŸeker', 'lokum']
            };
            
            for (const [category, keywords] of Object.entries(categories)) {
                for (const keyword of keywords) {
                    if (name.includes(keyword)) {
                        return category;
                    }
                }
            }
            return 'DiÄŸer';
        }

        // ÃœrÃ¼n ekleme fonksiyonu
        function addItem(name, quantity, unit) {
            if (!name || !name.trim()) {
                showNotification('âŒ LÃ¼tfen Ã¼rÃ¼n adÄ± girin!', 'error');
                return;
            }
            
            if (!quantity || quantity <= 0) {
                showNotification('âŒ LÃ¼tfen geÃ§erli bir miktar girin!', 'error');
                return;
            }
            
            const emoji = getItemEmoji(name);
            const displayQuantity = `${quantity} ${unit}`;
            
            const newShoppingItem = {
                id: Date.now() + Math.random(),
                name: name.trim(),
                quantity: displayQuantity,
                displayName: `${name.trim()} (${displayQuantity})`,
                emoji: emoji,
                completed: false,
                completedBy: null,
                addedBy: appState.user?.name || 'Anonim',
                category: categorizeItem(name),
                addedAt: new Date().toLocaleString('tr-TR')
            };
            
            try {
                updateState({
                    shoppingList: [...appState.shoppingList, newShoppingItem],
                    newItem: '',
                    newQuantity: '1',
                    newUnit: 'adet'
                });
                
                appState.productSuggestions = [];
                const suggestionsEl = document.getElementById('product-suggestions');
                if (suggestionsEl) {
                    suggestionsEl.innerHTML = '';
                }
                
                const nameInput = document.getElementById('newItemInput'); // ID dÃ¼zeltildi
                const quantityInput = document.getElementById('newQuantityInput'); // ID dÃ¼zeltildi
                const unitSelect = document.getElementById('newUnitSelect'); // ID dÃ¼zeltildi
                
                if (nameInput) nameInput.value = '';
                if (quantityInput) quantityInput.value = '1';
                if (unitSelect) unitSelect.value = 'adet';
                
                showNotification(`${emoji} ${name.trim()} (${displayQuantity}) listeye eklendi! âœ…`, 'success');
                
            } catch (error) {
                console.error('ÃœrÃ¼n eklenirken hata:', error);
                showNotification('âŒ ÃœrÃ¼n eklenirken bir hata oluÅŸtu!', 'error');
            }
        }

        // Form submit handler
        function handleAddItemSubmit(event) {
            event.preventDefault();
            
            const nameInput = document.getElementById('newItemInput'); // ID dÃ¼zeltildi
            const quantityInput = document.getElementById('newQuantityInput'); // ID dÃ¼zeltildi
            const unitSelect = document.getElementById('newUnitSelect'); // ID dÃ¼zeltildi
            
            if (!nameInput || !quantityInput || !unitSelect) {
                console.error('Form elementleri bulunamadÄ±');
                showNotification('âŒ Form elementleri bulunamadÄ±!', 'error');
                return;
            }
            
            const name = nameInput.value.trim();
            const quantity = parseFloat(quantityInput.value);
            const unit = unitSelect.value;
            
            addItem(name, quantity, unit);
        }

        // Buton click handler
        function handleAddButtonClick() {
            const nameInput = document.getElementById('newItemInput'); // ID dÃ¼zeltildi
            const quantityInput = document.getElementById('newQuantityInput'); // ID dÃ¼zeltildi
            const unitSelect = document.getElementById('newUnitSelect'); // ID dÃ¼zeltildi
            
            if (!nameInput || !quantityInput || !unitSelect) {
                console.error('Form elementleri bulunamadÄ±');
                showNotification('âŒ Form elementleri bulunamadÄ±!', 'error');
                return;
            }
            
            const name = nameInput.value.trim();
            const quantity = parseFloat(quantityInput.value);
            const unit = unitSelect.value;
            
            addItem(name, quantity, unit);
        }

        // Event listener'larÄ± baÄŸlama (DOMContentLoaded iÃ§inde olmalÄ±)
        document.addEventListener('DOMContentLoaded', function() {
            // addItem fonksiyonu artÄ±k render iÃ§inde Ã§aÄŸrÄ±lmÄ±yor, addNewItem fonksiyonu Ã§aÄŸÄ±rÄ±yor.
            // Bu nedenle, add-item-form ve add-item-btn artÄ±k doÄŸrudan DOM'da bulunmayabilir.
            // Sadece eÄŸer bu ID'lere sahip elementler varsa dinleyici eklenmeli.

            // Home render edildikten sonra elementler DOM'a ekleniyor
            // Bu event listener'lar render fonksiyonu iÃ§inde veya render sonrasÄ± Ã§aÄŸrÄ±lan bir fonksiyonda kurulmalÄ±.
            // Åimdilik burayÄ± yoruma alÄ±yorum, render sonrasÄ± fonksiyonlara taÅŸÄ±nacak.
        });


        function toggleItemComplete(id) {
            const updatedList = appState.shoppingList.map(item => {
                if (String(item.id) === String(id)) {
                    const newCompleted = !item.completed;
                    return { 
                        ...item, 
                        completed: newCompleted,
                        completedBy: newCompleted ? appState.user.name : null,
                        completedAt: newCompleted ? new Date().toLocaleString('tr-TR') : null
                    };
                }
                return item;
            });
            
            updateState({ shoppingList: updatedList });
            
            const item = updatedList.find(item => String(item.id) === String(id));
            if (item) {
                if (item.completed) {
                    showNotification(`${item.emoji} ${item.name} ${item.completedBy} tarafÄ±ndan alÄ±ndÄ±! âœ…`);
                } else {
                    showNotification(`${item.emoji} ${item.name} tekrar listeye eklendi! ğŸ”„`);
                }
            }
        }

        function deleteItemFromList(id) {
            const item = appState.shoppingList.find(item => String(item.id) === String(id));
            if (!item) {
                showNotification('ÃœrÃ¼n bulunamadÄ±!', 'error');
                return;
            }
            
            const updatedList = appState.shoppingList.filter(item => String(item.id) !== String(id));
            updateState({ shoppingList: updatedList });
            showNotification(`${item.emoji} ${item.name} listeden silindi! ğŸ—‘ï¸`);
        }

        // Levenshtein Distance for "Did you mean?" functionality
        function levenshteinDistance(a, b) {
            if (a.length === 0) return b.length;
            if (b.length === 0) return a.length;
            
            const matrix = [];
            for (let i = 0; i <= b.length; i++) {
                matrix[i] = [i];
            }
            for (let j = 0; j <= a.length; j++) {
                matrix[0][j] = j;
            }

            for (let i = 1; i <= b.length; i++) {
                for (let j = 1; j <= a.length; j++) {
                    const cost = (a[j - 1] === b[i - 1]) ? 0 : 1;
                    matrix[i][j] = Math.min(
                        matrix[i - 1][j] + 1,      // deletion
                        matrix[i][j - 1] + 1,      // insertion
                        matrix[i - 1][j - 1] + cost // substitution
                    );
                }
            }
            return matrix[b.length][a.length];
        }

        function handleAiQuery() {
            const query = appState.aiQuery.toLowerCase().trim();
            
            if (!query) {
                showNotification('LÃ¼tfen bir yemek adÄ± yazÄ±n!', 'error');
                return;
            }

            let found = false;
            let matchedMeal = null;
            let closestMatch = null;
            let minDistance = Infinity;

            for (const [mealName, mealData] of Object.entries(chefMealDatabase)) {
                // Exact match or includes
                if (query === mealName || mealName.includes(query)) {
                    matchedMeal = mealData;
                    found = true;
                    break;
                }
                
                // Calculate Levenshtein distance for "Did you mean?"
                const distance = levenshteinDistance(query, mealName);
                if (distance < minDistance) {
                    minDistance = distance;
                    closestMatch = mealName;
                }
            }

            if (found && matchedMeal) {
                updateState({
                    aiSuggestions: matchedMeal.ingredients,
                    aiBotResponse: `${matchedMeal.response}\n\n**YapÄ±lÄ±ÅŸÄ±:**\n${matchedMeal.instructions.map((inst, index) => `${index + 1}. ${inst}`).join('\n')}`
                });
            } else {
                let responseText = `Hmm, "${query}" mi? ğŸ¤” ${appState.chefName} ÅŸu anda bu tarifi araÅŸtÄ±rÄ±yor!`;
                
                // Suggest if a close match is found (threshold for similarity, e.g., distance < 3 for short words)
                if (closestMatch && minDistance <= Math.max(query.length, closestMatch.length) * 0.4) { // Dynamic threshold
                    responseText += `\n\nBunu mu demek istediniz: <strong>${closestMatch.charAt(0).toUpperCase() + closestMatch.slice(1)}</strong>?`;
                }

                const availableMeals = Object.keys(chefMealDatabase).slice(0, 8).join(', ');
                
                updateState({
                    aiSuggestions: [],
                    aiBotResponse: `${responseText}\n\nğŸ‘¨â€ğŸ³ ${appState.chefName}'in bildiÄŸi tariflerden bazÄ±larÄ±: ${availableMeals}...`
                });
            }
        }

        function addAiSuggestionsToList() {
            if (!appState.aiSuggestions || appState.aiSuggestions.length === 0) {
                showNotification('Eklenecek malzeme bulunamadÄ±!', 'error');
                return;
            }
            
            const newItems = [];
            
            appState.aiSuggestions.forEach(item => {
                const emoji = getItemEmoji(item.name);
                const newItem = {
                    id: Date.now() + Math.random(),
                    name: item.name,
                    quantity: item.quantity || '1 adet',
                    displayName: `${item.name} (${item.quantity || '1 adet'})`,
                    emoji: emoji,
                    completed: false,
                    completedBy: null,
                    addedBy: appState.user?.name,
                    category: categorizeItem(item.name),
                    addedAt: new Date().toLocaleString('tr-TR')
                };
                newItems.push(newItem);
            });
            
            const updatedShoppingList = [...appState.shoppingList, ...newItems];
            
            updateState({
                shoppingList: updatedShoppingList,
                aiSuggestions: [],
                aiBotResponse: '',
                aiQuery: '',
                currentPage: 'home'
            });
            
            showNotification(`${newItems.length} malzeme anasayfaya eklendi! âœ…`, 'success');
        }

        function toggleDarkModeFunction() {
            const newDarkMode = !appState.settings.darkMode;
            const newSettings = { ...appState.settings, darkMode: newDarkMode };
            updateState({ settings: newSettings });
            
            if (newDarkMode) {
                document.documentElement.setAttribute('data-theme', 'dark');
            } else {
                document.documentElement.removeAttribute('data-theme');
            }
            
            showNotification(newDarkMode ? 'Gece modu aÃ§Ä±ldÄ± ğŸŒ™' : 'GÃ¼ndÃ¼z modu aÃ§Ä±ldÄ± â˜€ï¸');
        }

        function toggleSetting(settingName) {
            const newSettings = { 
                ...appState.settings, 
                [settingName]: !appState.settings[settingName] 
            };
            
            updateState({ settings: newSettings });
            
            if (settingName === 'highContrast') {
                if (newSettings.highContrast) {
                    document.body.classList.add('high-contrast');
                    showNotification('YÃ¼ksek kontrast aÃ§Ä±ldÄ± ğŸ”†');
                } else {
                    document.body.classList.remove('high-contrast');
                    showNotification('YÃ¼ksek kontrast kapatÄ±ldÄ±');
                }
            }
            
            if (settingName === 'largeText') {
                if (newSettings.largeText) {
                    document.body.classList.add('large-text');
                    showNotification('BÃ¼yÃ¼k yazÄ± aÃ§Ä±ldÄ± ğŸ“');
                } else {
                    document.body.classList.remove('large-text');
                    showNotification('Normal yazÄ± boyutu');
                }
            }
        }

        // Sesli Komut FonksiyonlarÄ±
        function startVoiceRecognition() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRecognition) {
                showNotification('Sesli komut tarayÄ±cÄ±nÄ±zda desteklenmiyor.', 'error');
                return;
            }

            const recognition = new SpeechRecognition();
            recognition.lang = 'tr-TR';
            recognition.interimResults = false;
            recognition.maxAlternatives = 1;

            const voiceBtn = document.getElementById('voiceBtn');
            if (voiceBtn) voiceBtn.classList.add('listening');

            recognition.start();

            recognition.onresult = function(event) {
                const speechResult = event.results[0][0].transcript.toLowerCase();
                handleVoiceCommand(speechResult);
            };

            recognition.onspeechend = function() {
                recognition.stop();
                if (voiceBtn) voiceBtn.classList.remove('listening');
            };

            recognition.onerror = function(event) {
                showNotification('Ses tanÄ±mada hata oluÅŸtu: ' + event.error, 'error');
                if (voiceBtn) voiceBtn.classList.remove('listening');
            };
        }

        function handleVoiceCommand(command) {
            const parts = command.split(' ');
            let itemName = '';
            let quantity = '1';
            let unit = 'adet';
            const itemParts = parts.filter(part => part !== 'ekle' && part !== 'al');

            const quantityIndex = itemParts.findIndex(part => !isNaN(parseFloat(part)));
            if(quantityIndex > -1) {
                quantity = itemParts[quantityIndex];
                const unitWord = itemParts[quantityIndex + 1];
                if (['kilo', 'kg', 'gram', 'gr', 'litre', 'lt', 'paket', 'adet', 'ÅŸiÅŸe'].includes(unitWord)) {
                    unit = unitWord;
                    itemName = itemParts.filter((p, i) => i !== quantityIndex && i !== quantityIndex + 1).join(' ');
                } else {
                     itemName = itemParts.filter((p, i) => i !== quantityIndex).join(' ');
                }
            } else {
                itemName = itemParts.join(' ');
            }
            
            if (itemName.trim()) {
                addItem(itemName.trim(), quantity, unit);
                showNotification(`ğŸ™ï¸ Sesli komutla eklendi: ${itemName.trim()}`, 'success');
            } else {
                showNotification('AnlaÅŸÄ±lamadÄ±, lÃ¼tfen "2 kilo elma ekle" gibi tekrar deneyin.', 'error');
            }
        }

        // AkÄ±llÄ± ÃœrÃ¼n Ã–neri FonksiyonlarÄ±
        function showSuggestions() {
            const inputElement = document.getElementById('newItemInput');
            const suggestionsContainer = document.getElementById('product-suggestions');

            if (!inputElement || !suggestionsContainer) return;

            const value = inputElement.value.toLowerCase();
            appState.newItem = inputElement.value; // appState'i gÃ¼ncel tut

            if (!value) {
                appState.productSuggestions = [];
                suggestionsContainer.innerHTML = '';
                return;
            }

            const suggestions = productDatabase.filter(item => {
                const cleanItem = item.replace(/^[^\w\s]+\s*/, '').toLowerCase();
                return cleanItem.startsWith(value);
            }).slice(0, 8);

            appState.productSuggestions = suggestions;

            suggestionsContainer.innerHTML = suggestions.map(item => `
                <div class="suggestion-item" onclick="selectSuggestion('${item.replace(/'/g, '\\\'')}')">${item}</div>
            `).join('');
        }

        function selectSuggestion(itemName) {
            const nameInput = document.getElementById('newItemInput');
            const suggestionsContainer = document.getElementById('product-suggestions');
            
            if (nameInput) {
                const cleanItemName = itemName.replace(/^[^\w\s]+\s*/, '');
                nameInput.value = cleanItemName;
                nameInput.focus();
            }
            
            appState.newItem = itemName.replace(/^[^\w\s]+\s*/, '');
            appState.productSuggestions = [];
            
            if (suggestionsContainer) {
                suggestionsContainer.innerHTML = '';
            }
            
            updateState({ 
                newItem: itemName.replace(/^[^\w\s]+\s*/, ''),
                productSuggestions: [] 
            });
        }

        // Render functions
        function renderLogin() {
            return `
                <div class="login-container">
                    <div class="login-form">
                        <div class="login-logo-container">
                            <span class="login-logo">ğŸ›ï¸</span>
                            <h1>AkÄ±llÄ±Market</h1>
                        </div>
                        <p>AkÄ±llÄ± alÄ±ÅŸveriÅŸ asistanÄ±nÄ±z</p>
                        <input type="text" id="loginInput" placeholder="KullanÄ±cÄ± adÄ±nÄ±zÄ± girin">
                        <button onclick="handleLoginClick()">BaÅŸlayalÄ±m</button>
                    </div>
                </div>
            `;
        }

        function renderHome() {
            const totalItems = appState.shoppingList.length;
            const completedItems = appState.shoppingList.filter(item => item.completed).length;
            const groupedItems = appState.shoppingList.reduce((groups, item) => {
                const category = item.category;
                if (!groups[category]) {
                    groups[category] = [];
                }
                groups[category].push(item);
                return groups;
            }, {});
            const categories = Object.keys(groupedItems).length;

            return `
                <header class="app-header">
                    <h1>
                        <span class="header-logo">ğŸ›ï¸</span>
                        AkÄ±llÄ±Market
                    </h1>
                    <div class="user-info">
                        ${appState.user.name}
                        <button onclick="logout()">Ã‡Ä±kÄ±ÅŸ</button>
                    </div>
                </header>

                <div class="main-content">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <span class="stat-number">${totalItems}</span>
                            <span class="stat-label">ÃœrÃ¼n</span>
                        </div>
                        <div class="stat-card">
                            <span class="stat-number">${completedItems}</span>
                            <span class="stat-label">AlÄ±ndÄ±</span>
                        </div>
                        <div class="stat-card">
                            <span class="stat-number">${categories}</span>
                            <span class="stat-label">Kategori</span>
                        </div>
                    </div>

                    ${!appState.shareCode ? `
                        <div class="card">
                            <h2 class="card-title">ğŸ‘¥ Aile Listesi</h2>
                            <p style="margin-bottom: 16px; color: var(--text-light);">
                                Aileniz, eÅŸiniz veya ev arkadaÅŸÄ±nÄ±zla aynÄ± alÄ±ÅŸveriÅŸ listesini paylaÅŸÄ±n!
                            </p>
                            <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                                <button class="btn-primary" onclick="createSharedList()" style="flex: 1; min-width: 140px;">
                                    ğŸ“± Liste OluÅŸtur
                                </button>
                                <button class="btn-secondary" onclick="joinSharedListPrompt()" style="flex: 1; min-width: 140px;">
                                    ğŸ”— Listeye KatÄ±l
                                </button>
                            </div>
                        </div>
                    ` : `
                        <div class="card">
                            <h2 class="card-title">ğŸ‘¥ Aile Listesi</h2>
                            <p style="margin-bottom: 12px;">
                                <strong>PaylaÅŸÄ±m Kodu:</strong> <span style="background: var(--primary-color); color: white; padding: 4px 8px; border-radius: 8px; font-weight: bold;">${appState.shareCode}</span>
                            </p>
                            <p style="margin-bottom: 16px; color: var(--text-light);">
                                <strong>KatÄ±lÄ±mcÄ±lar:</strong> ${appState.sharedUsers.map(user => user.name + (user.isOwner ? ' (Sahibi)' : '')).join(', ')}
                            </p>
                            <button class="btn-secondary" onclick="generateQRCode()" style="background: linear-gradient(135deg, var(--accent-color) 0%, #059669 100%); margin-bottom: 12px;">
                                ğŸ“± PaylaÅŸ
                            </button>
                            <button class="btn-secondary" onclick="leaveSharedListConfirm()" style="background: linear-gradient(135deg, var(--danger-color) 0%, var(--danger-dark) 100%);">
                                ğŸ‘‹ Listeden AyrÄ±l
                            </button>
                        </div>
                    `}

                    <div class="card">
                        <h2 class="card-title">âœ¨ ÃœrÃ¼n Ekle</h2>
                        <div style="display: flex; align-items: flex-start; gap: 10px; flex-wrap: wrap;">
                            <div class="suggestions-container" style="flex-grow: 1; flex-basis: calc(100% - 74px);">
                                <div class="two-column-input" style="margin-bottom: 0;">
                                    <input 
                                        type="text" 
                                        id="newItemInput" 
                                        placeholder="ÃœrÃ¼n adÄ± yazÄ±n veya mikrofona basÄ±n" 
                                        value="${appState.newItem}"
                                        oninput="showSuggestions()"
                                        autocomplete="off">
                                    <div style="display: flex; gap: 12px;">
                                        <input type="number" id="newQuantityInput" placeholder="Miktar" value="${appState.newQuantity}" style="width: 80px;">
                                        <select id="newUnitSelect" style="width: 100px;">
                                            <option value="adet" ${appState.newUnit === 'adet' ? 'selected' : ''}>Adet</option>
                                            <option value="kg" ${appState.newUnit === 'kg' ? 'selected' : ''}>Kg</option>
                                            <option value="g" ${appState.newUnit === 'g' ? 'selected' : ''}>Gram</option>
                                            <option value="l" ${appState.newUnit === 'l' ? 'selected' : ''}>Litre</option>
                                            <option value="ml" ${appState.newUnit === 'ml' ? 'selected' : ''}>ML</option>
                                            <option value="paket" ${appState.newUnit === 'paket' ? 'selected' : ''}>Paket</option>
                                            <option value="ÅŸiÅŸe" ${appState.newUnit === 'ÅŸiÅŸe' ? 'selected' : ''}>ÅiÅŸe</option>
                                        </select>
                                    </div>
                                </div>
                                <div id="product-suggestions">
                                    ${appState.productSuggestions.map(item => `
                                        <div class="suggestion-item" onclick="selectSuggestion('${item.replace(/'/g, '\\\'')}')">${item}</div>
                                    `).join('')}
                                </div>
                            </div>
                            <button id="voiceBtn" class="voice-btn" onclick="startVoiceRecognition()">ğŸ¤</button>
                        </div>
                        <button class="btn-primary" style="width: 100%; margin-top: 24px;" onclick="addNewItem()">ğŸ›’ ÃœrÃ¼n Ekle</button>
                    </div>

                    ${Object.keys(groupedItems).length > 0 ? Object.keys(groupedItems).map(category => `
                        <div class="category-header">
                            ${category}
                            <span>${groupedItems[category].length}</span>
                        </div>
                        ${groupedItems[category].map(item => `
                            <div class="shopping-item ${item.completed ? 'completed' : ''}">
                                <button class="check-btn ${item.completed ? 'completed' : ''}" onclick="toggleItemComplete('${item.id}')">
                                    ${item.completed ? 'âœ“' : ''}
                                </button>
                                <span style="font-size: 24px; flex-shrink: 0;">${item.emoji}</span>
                                <div class="shopping-item-content">
                                    <div class="shopping-item-name">${item.name}</div>
                                    <div class="shopping-item-meta">
                                        ${item.quantity} â€¢ ${item.addedBy} ekledi
                                        ${item.completed ? ` â€¢ ${item.completedBy} aldÄ±` : ''}
                                    </div>
                                </div>
                                <button class="delete-btn" onclick="deleteItemFromList('${item.id}')">ğŸ—‘ï¸</button>
                            </div>
                        `).join('')}
                    `).join('') : '<div class="card"><p style="text-align: center; color: var(--text-light);">HenÃ¼z Ã¼rÃ¼n eklenmemiÅŸ ğŸ›’</p></div>'}
                </div>

                <nav class="bottom-nav">
                    <div class="nav-item ${appState.currentPage === 'home' ? 'active' : ''}" onclick="changePage('home')">
                        <div class="nav-icon">ğŸ </div>
                        <span>Ana Sayfa</span>
                    </div>
                    <div class="nav-item ${appState.currentPage === 'chef' ? 'active' : ''}" onclick="changePage('chef')">
                        <div class="nav-icon">ğŸ‘¨â€ğŸ³</div>
                        <span>AÅŸÃ§Ä±</span>
                    </div>
                    <div class="nav-item ${appState.currentPage === 'settings' ? 'active' : ''}" onclick="changePage('settings')">
                        <div class="nav-icon">âš™ï¸</div>
                        <span>Ayarlar</span>
                    </div>
                </nav>
            `;
        }

        function renderChef() {
            return `
                <header class="app-header">
                    <h1>
                        <span class="header-logo">ğŸ›ï¸</span>
                        ${appState.chefName}
                    </h1>
                    <div class="user-info">
                        ${appState.user.name}
                        <button onclick="logout()">Ã‡Ä±kÄ±ÅŸ</button>
                    </div>
                </header>

                <div class="main-content">
                    <div class="card">
                        <h2 class="card-title">ğŸ‘¨â€ğŸ³ AÅŸÃ§Ä± AyarlarÄ±</h2>
                        <div class="input-group">
                            <input type="text" id="chefNameInput" placeholder="AÅŸÃ§Ä±nÄ±zÄ±n adÄ±nÄ± girin" value="${appState.chefName}">
                            <button class="btn-primary" onclick="updateChefName()">GÃ¼ncelle</button>
                        </div>
                        <p style="font-size: 13px; color: var(--text-light); margin-top: 8px;">
                            ğŸ’¡ AÅŸÃ§Ä±nÄ±za istediÄŸiniz ismi verebilirsiniz!
                        </p>
                    </div>

                    <div class="card">
                        <h2 class="card-title">ğŸ‘¨â€ğŸ³ Yemek Ara</h2>
                        <div class="input-group">
                            <input type="text" id="aiQueryInput" placeholder="Hangi yemek yapmak istiyorsun?" value="${appState.aiQuery}">
                            <button class="btn-primary" onclick="handleAiQueryClick()">Ara</button>
                        </div>
                        <p style="font-size: 13px; color: var(--text-light); margin-top: 8px;">
                            ğŸ’¡ Ã–rnek: "makarna", "omlet", "pizza"
                        </p>
                    </div>

                    ${appState.aiBotResponse ? `
                        <div class="ai-bot-response">
                            <h3 style="margin-bottom: 12px;">ğŸ¤– ${appState.chefName} Diyor:</h3>
                            <p style="white-space: pre-line;">${appState.aiBotResponse}</p>
                        </div>
                    ` : ''}

                    ${appState.aiSuggestions.length > 0 ? `
                        <div class="ai-suggestions">
                            <h3 style="margin-bottom: 16px;">ğŸ›’ Gerekli Malzemeler:</h3>
                            ${appState.aiSuggestions.map(item => `
                                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                                    <span style="font-size: 20px; flex-shrink: 0;">${getItemEmoji(item.name)}</span>
                                    <span style="font-weight: 500;">${item.name}</span>
                                    <span style="color: var(--text-light); flex-shrink: 0;">(${item.quantity})</span>
                                </div>
                            `).join('')}
                            <button class="btn-secondary" onclick="addAiSuggestionsToList()" style="margin-top: 16px;">
                                TÃ¼mÃ¼nÃ¼ Listeye Ekle
                            </button>
                        </div>
                    ` : ''}

                    <!-- New section for AI Recipe Generation -->
                    <div class="card">
                        <h2 class="card-title">âœ¨ ${appState.chefName} Tarif OluÅŸtur</h2>
                        <div class="input-group">
                            <textarea id="recipeIngredientsInput" placeholder="Sahip olduÄŸunuz malzemeleri virgÃ¼lle ayÄ±rarak yazÄ±n (Ã¶rn: tavuk, pirinÃ§, havuÃ§)" rows="3" style="width: 100%; padding: 16px; border-radius: 16px; border: 1px solid var(--border-color); resize: vertical; background: var(--background-color); color: var(--text-color);"></textarea>
                        </div>
                        <button class="btn-primary" onclick="generateRecipeWithAI()">âœ¨ Tarif OluÅŸtur</button>
                        <div id="loadingIndicator" style="display: none; text-align: center; margin-top: 15px; color: var(--primary-color);">YÃ¼kleniyor...</div>
                        <div id="aiGeneratedRecipe" style="margin-top: 20px;">
                            <!-- AI tarafÄ±ndan oluÅŸturulan tarif burada gÃ¶sterilecek -->
                            ${appState.aiGeneratedRecipe ? `
                                <div class="card" style="margin-top: 20px;">
                                    <h3 class="card-title">${appState.aiGeneratedRecipe.recipeName}</h3>
                                    <h4 style="font-size: 18px; margin-bottom: 10px; color: var(--primary-color);">Malzemeler:</h4>
                                    <ul style="list-style: disc; margin-left: 20px; margin-bottom: 20px;">
                                        ${appState.aiGeneratedRecipe.ingredients.map(ing => `
                                            <li>${getItemEmoji(ing.item)} ${ing.item}: <strong>${ing.quantity}</strong></li>
                                        `).join('')}
                                    </ul>
                                    <h4 style="font-size: 18px; margin-bottom: 10px; color: var(--primary-color);">Talimatlar:</h4>
                                    <ol style="list-style: decimal; margin-left: 20px;">
                                        ${appState.aiGeneratedRecipe.instructions.map(inst => `
                                            <li>${inst}</li>
                                        `).join('')}
                                    </ol>
                                    <button class="btn-primary" onclick="addRecipeIngredientsToList()">Tarif Malzemelerini Listeye Ekle</button>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                </div>

                <nav class="bottom-nav">
                    <div class="nav-item ${appState.currentPage === 'home' ? 'active' : ''}" onclick="changePage('home')">
                        <div class="nav-icon">ğŸ </div>
                        <span>Ana Sayfa</span>
                    </div>
                    <div class="nav-item ${appState.currentPage === 'chef' ? 'active' : ''}" onclick="changePage('chef')">
                        <div class="nav-icon">ğŸ‘¨â€ğŸ³</div>
                        <span>AÅŸÃ§Ä±</span>
                    </div>
                    <div class="nav-item ${appState.currentPage === 'settings' ? 'active' : ''}" onclick="changePage('settings')">
                        <div class="nav-icon">âš™ï¸</div>
                        <span>Ayarlar</span>
                    </div>
                </nav>
            `;
        }

        function renderSettings() {
            return `
                <header class="app-header">
                    <h1>
                        <span class="header-logo">ğŸ›ï¸</span>
                        Ayarlar
                    </h1>
                    <div class="user-info">
                        ${appState.user.name}
                        <button onclick="logout()">Ã‡Ä±kÄ±ÅŸ</button>
                    </div>
                </header>

                <div class="main-content">
                    <div class="card">
                        <h2 class="card-title">ğŸ¨ GÃ¶rÃ¼nÃ¼m</h2>
                        
                        <div class="setting-item">
                            <div>
                                <div class="setting-label">Gece Modu</div>
                                <div class="setting-description">Koyu tema kullan</div>
                            </div>
                            <div class="toggle-switch ${appState.settings.darkMode ? 'active' : ''}" onclick="toggleDarkModeFunction()">
                                <div class="toggle-slider"></div>
                            </div>
                        </div>

                        <div class="setting-item">
                            <div>
                                <div class="setting-label">YÃ¼ksek Kontrast</div>
                                <div class="setting-description">Daha net gÃ¶rÃ¼nÃ¼m</div>
                            </div>
                            <div class="toggle-switch ${appState.settings.highContrast ? 'active' : ''}" onclick="toggleSetting('highContrast')">
                                <div class="toggle-slider"></div>
                            </div>
                        </div>

                        <div class="setting-item">
                            <div>
                                <div class="setting-label">BÃ¼yÃ¼k YazÄ±</div>
                                <div class="setting-description">YazÄ±larÄ± bÃ¼yÃ¼t</div>
                            </div>
                            <div class="toggle-switch ${appState.settings.largeText ? 'active' : ''}" onclick="toggleSetting('largeText')">
                                <div class="toggle-slider"></div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <h2 class="card-title">ğŸ“¢ Sosyal PaylaÅŸÄ±m</h2>
                        <p style="margin-bottom: 16px; color: var(--text-light);">
                            BaÅŸarÄ±larÄ±nÄ±zÄ± veya listelerinizi arkadaÅŸlarÄ±nÄ±zla paylaÅŸÄ±n!
                        </p>
                        <div style="display: flex; flex-direction: column; gap: 12px;">
                            <button class="btn-primary" onclick="shareShoppingList()">
                                ğŸ“ AlÄ±ÅŸveriÅŸ Listemi PaylaÅŸ
                            </button>
                            <button class="btn-secondary" onclick="shareAchievement()">
                                ğŸ† BaÅŸarÄ±mÄ± PaylaÅŸ
                            </button>
                            <button class="btn-secondary" onclick="shareFavoriteProduct()">
                                â¤ï¸ Favori ÃœrÃ¼nÃ¼mÃ¼ PaylaÅŸ
                            </button>
                        </div>
                    </div>

                    <div class="card">
                        <h2 class="card-title">ğŸ¤ Sosyal EtkileÅŸim</h2>
                        <p style="margin-bottom: 16px; color: var(--text-light);">
                            ArkadaÅŸlarÄ±nÄ±zÄ± davet edin veya yarÄ±ÅŸmalara katÄ±lÄ±n!
                        </p>
                        <div class="input-group">
                            <input type="text" id="friendInviteInput" placeholder="ArkadaÅŸÄ±nÄ±zÄ±n adÄ±nÄ± girin">
                            <button class="btn-primary" onclick="inviteFriend()">Davet Et</button>
                        </div>
                        <button class="btn-secondary" onclick="showCompetitionsInfo()">
                            ğŸ… YarÄ±ÅŸmalar (YakÄ±nda)
                        </button>
                    </div>

                    <div class="card">
                        <h2 class="card-title">ğŸ“Š Ä°statistikler</h2>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; text-align: center;">
                            <div>
                                <div style="font-size: 24px; font-weight: 700; color: var(--primary-color);">${appState.shoppingList.length}</div>
                                <div style="font-size: 14px; color: var(--text-light);">Toplam ÃœrÃ¼n</div>
                            </div>
                            <div>
                                <div style="font-size: 24px; font-weight: 700; color: var(--accent-color);">${appState.shoppingList.filter(item => item.completed).length}</div>
                                <div style="font-size: 14px; color: var(--text-light);">AlÄ±nan ÃœrÃ¼n</div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <h2 class="card-title">ğŸ—‘ï¸ Veri YÃ¶netimi</h2>
                        <button class="btn-secondary" onclick="clearAllDataConfirm()" style="background: linear-gradient(135deg, var(--danger-color) 0%, var(--danger-dark) 100%);">
                            TÃ¼m Verileri Temizle
                        </button>
                        <p style="font-size: 12px; color: var(--text-light); margin-top: 8px;">
                            âš ï¸ Bu iÅŸlem geri alÄ±namaz
                        </p>
                    </div>
                </div>

                <nav class="bottom-nav">
                    <div class="nav-item ${appState.currentPage === 'home' ? 'active' : ''}" onclick="changePage('home')">
                        <div class="nav-icon">ğŸ </div>
                        <span>Ana Sayfa</span>
                    </div>
                    <div class="nav-item ${appState.currentPage === 'chef' ? 'active' : ''}" onclick="changePage('chef')">
                        <div class="nav-icon">ğŸ‘¨â€ğŸ³</div>
                        <span>AÅŸÃ§Ä±</span>
                    </div>
                    <div class="nav-item ${appState.currentPage === 'settings' ? 'active' : ''}" onclick="changePage('settings')">
                        <div class="nav-icon">âš™ï¸</div>
                        <span>Ayarlar</span>
                    </div>
                </nav>
            `;
        }

        // Global functions
        function generateShareCode() {
            return Math.random().toString(36).substring(2, 8).toUpperCase();
        }

        function createSharedList() {
            const shareCode = generateShareCode();
            updateState({ 
                shareCode: shareCode,
                sharedUsers: [{ name: appState.user.name, id: appState.user.id, isOwner: true }]
            });
            showNotification(`PaylaÅŸÄ±m kodu: ${shareCode} - Bu kodu ailenizle paylaÅŸÄ±n! ğŸ“±`);
        }

        function joinSharedList(code) {
            if (!code || code.length !== 6) {
                showNotification('GeÃ§ersiz paylaÅŸÄ±m kodu!', 'error');
                return;
            }
            
            // Check if user is already in the shared list
            const isUserAlreadyInList = appState.sharedUsers.some(user => user.id === appState.user.id);
            if (!isUserAlreadyInList) {
                const newSharedUsers = [...appState.sharedUsers, { 
                    name: appState.user.name, 
                    id: appState.user.id, 
                    isOwner: false 
                }];
                updateState({ 
                    shareCode: code,
                    sharedUsers: newSharedUsers
                });
                showNotification(`${code} kodlu listeye katÄ±ldÄ±nÄ±z! ğŸ‰`);
            } else {
                showNotification('Zaten bu listeye katÄ±lmÄ±ÅŸsÄ±nÄ±z.', 'info');
            }
        }

        function leaveSharedList() {
            updateState({ 
                shareCode: null,
                sharedUsers: []
            });
            showNotification('PaylaÅŸÄ±mlÄ± listeden ayrÄ±ldÄ±nÄ±z! ğŸ‘‹');
        }

        // Custom Confirmation Modal Logic
        let confirmCallback = null; // Store the callback function

        function showConfirmModal(title, message, onConfirm) {
            document.getElementById('confirmModalTitle').textContent = title;
            document.getElementById('confirmModalMessage').textContent = message;
            document.getElementById('confirmModalOverlay').classList.add('show');
            confirmCallback = onConfirm; // Set the callback
        }

        function hideConfirmModal() {
            document.getElementById('confirmModalOverlay').classList.remove('show');
            confirmCallback = null; // Clear the callback
        }

        // Event listeners for the custom confirmation modal buttons
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('confirmBtnYes').addEventListener('click', () => {
                if (confirmCallback) {
                    confirmCallback();
                }
                hideConfirmModal();
            });

            document.getElementById('confirmBtnNo').addEventListener('click', () => {
                hideConfirmModal();
            });

            // Close modal if clicking outside (optional, but good UX)
            document.getElementById('confirmModalOverlay').addEventListener('click', (e) => {
                if (e.target.id === 'confirmModalOverlay') {
                    hideConfirmModal();
                }
            });
        });

        // Updated confirmAction to use the custom modal
        function confirmAction(message, callback) {
            showConfirmModal('Emin Misiniz?', message, callback);
        }

        window.createSharedList = createSharedList;
        window.joinSharedListPrompt = function() {
            // KullanÄ±cÄ±dan kodu almak iÃ§in daha iyi bir UI kullanÄ±lmalÄ±
            const code = prompt('PaylaÅŸÄ±m kodunu girin:');
            if (code) joinSharedList(code.toUpperCase());
        };
        window.leaveSharedListConfirm = function() {
            confirmAction('PaylaÅŸÄ±mlÄ± listeden ayrÄ±lmak istediÄŸinizden emin misiniz?', leaveSharedList);
        };

        // Tab Senkronizasyonu
        function syncWithOtherTabs() {
            window.addEventListener('storage', (e) => {
                if (e.key === 'akilliMarket_shoppingList') {
                    const newList = JSON.parse(e.newValue || '[]');
                    // Sadece farklÄ±ysa gÃ¼ncelle
                    if (JSON.stringify(appState.shoppingList) !== JSON.stringify(newList)) {
                        appState.shoppingList = newList;
                        render(); // Force re-render without saving again
                        showNotification('Liste baÅŸka sekmeden gÃ¼ncellendi! ğŸ”„');
                    }
                }
                if (e.key === 'akilliMarket_shareCode') {
                    const newShareCode = e.newValue;
                    if (appState.shareCode !== newShareCode) {
                        appState.shareCode = newShareCode;
                        render();
                    }
                }
                if (e.key === 'akilliMarket_sharedUsers') {
                    const newSharedUsers = JSON.parse(e.newValue || '[]');
                     if (JSON.stringify(appState.sharedUsers) !== JSON.stringify(newSharedUsers)) {
                        appState.sharedUsers = newSharedUsers;
                        render();
                    }
                }
                if (e.key === 'akilliMarket_settings') {
                    const newSettings = JSON.parse(e.newValue || '{}');
                    if (JSON.stringify(appState.settings) !== JSON.stringify(newSettings)) {
                        appState.settings = newSettings;
                        document.documentElement.setAttribute('data-theme', newSettings.darkMode ? 'dark' : '');
                        document.body.classList.toggle('high-contrast', newSettings.highContrast);
                        document.body.classList.toggle('large-text', newSettings.largeText);
                        render();
                    }
                }
            });
        }

        // QR Kod PaylaÅŸÄ±mÄ± (Basit bir kopyalama iÅŸlevi, QR kod gÃ¶rseli Ã¼retmez)
        function generateQRCode() {
            const url = `${window.location.origin}${window.location.pathname}?shareCode=${appState.shareCode}`;
            const qrText = `AkÄ±llÄ±Market Listesi\nKod: ${appState.shareCode}\nLink: ${url}`;
            
            // Clipboard API'si modern tarayÄ±cÄ±larda tercih edilir
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(qrText).then(() => {
                    showNotification('Liste bilgileri panoya kopyalandÄ±! ğŸ“‹');
                }).catch(err => {
                    console.error('Panoya kopyalama baÅŸarÄ±sÄ±z oldu (Clipboard API):', err);
                    // Fallback iÃ§in execCommand kullan
                    copyTextToClipboardFallback(qrText);
                });
            } else {
                // Eski tarayÄ±cÄ±lar iÃ§in fallback
                copyTextToClipboardFallback(qrText);
            }
        }

        // Clipboard API desteÄŸi olmayan tarayÄ±cÄ±lar iÃ§in fallback
        function copyTextToClipboardFallback(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed'; // Ekran dÄ±ÅŸÄ±na taÅŸÄ±
            textArea.style.left = '-9999px';
            textArea.style.top = '-9999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            try {
                document.execCommand('copy');
                showNotification('Liste bilgileri panoya kopyalandÄ±! ğŸ“‹');
            } catch (err) {
                console.error('Panoya kopyalama baÅŸarÄ±sÄ±z oldu (execCommand):', err);
                showNotification('Panoya kopyalanamadÄ±, lÃ¼tfen manuel kopyalayÄ±n.', 'error');
            } finally {
                document.body.removeChild(textArea);
            }
        }

        // --- Sosyal PaylaÅŸÄ±m FonksiyonlarÄ± ---
        async function shareContent(title, text) {
            if (navigator.share) {
                try {
                    await navigator.share({
                        title: title,
                        text: text,
                    });
                    showNotification('Ä°Ã§erik baÅŸarÄ±yla paylaÅŸÄ±ldÄ±! ğŸš€');
                } catch (error) {
                    if (error.name === 'AbortError') {
                        showNotification('PaylaÅŸma iptal edildi.', 'info');
                    } else {
                        console.error('Ä°Ã§erik paylaÅŸÄ±lÄ±rken hata:', error);
                        showNotification('Ä°Ã§erik paylaÅŸÄ±lamadÄ±.', 'error');
                    }
                }
            } else {
                // Fallback: Copy to clipboard
                copyTextToClipboardFallback(`${title}\n${text}`);
                showNotification('PaylaÅŸÄ±m Ã¶zelliÄŸi desteklenmiyor. Ä°Ã§erik panoya kopyalandÄ±! ğŸ“‹');
            }
        }

        window.shareShoppingList = function() {
            const listItems = appState.shoppingList.map(item => `${getItemEmoji(item.name)} ${item.name} (${item.quantity})`).join('\n');
            const message = `AkÄ±llÄ±Market alÄ±ÅŸveriÅŸ listem:\n${listItems}\n\n#AkÄ±llÄ±Market #AlÄ±ÅŸveriÅŸListesi`;
            shareContent('AkÄ±llÄ±Market AlÄ±ÅŸveriÅŸ Listem', message);
        };

        window.shareAchievement = function() {
            const completedCount = appState.shoppingList.filter(item => item.completed).length;
            const totalCount = appState.shoppingList.length;
            const message = `BugÃ¼n AkÄ±llÄ±Market ile ${totalCount} Ã¼rÃ¼nden ${completedCount} tanesini aldÄ±m! ğŸš€ Harika bir alÄ±ÅŸveriÅŸ gÃ¼nÃ¼! #AkÄ±llÄ±Market #BaÅŸarÄ±`;
            shareContent('AkÄ±llÄ±Market BaÅŸarÄ±m', message);
        };

        window.shareFavoriteProduct = function() {
            let favoriteProduct = 'Favori bir Ã¼rÃ¼nÃ¼m yok.';
            if (appState.shoppingList.length > 0) {
                // For simplicity, let's pick a random item or the most recent one
                const randomIndex = Math.floor(Math.random() * appState.shoppingList.length);
                const item = appState.shoppingList[randomIndex];
                favoriteProduct = `En sevdiÄŸim Ã¼rÃ¼n: ${getItemEmoji(item.name)} ${item.name} (${item.quantity})! Sizinki ne?`;
            } else {
                favoriteProduct = "HenÃ¼z alÄ±ÅŸveriÅŸ listemde bir Ã¼rÃ¼n yok, ama Ã§ok yakÄ±nda harika Ã¼rÃ¼nler ekleyeceÄŸim!";
            }
            const message = `${favoriteProduct}\n\n#AkÄ±llÄ±Market #FavoriÃœrÃ¼n`;
            shareContent('AkÄ±llÄ±Market Favori ÃœrÃ¼nÃ¼m', message);
        };

        // --- Sosyal EtkileÅŸim FonksiyonlarÄ± (SimÃ¼le EdilmiÅŸ) ---
        window.inviteFriend = function() {
            const friendNameInput = document.getElementById('friendInviteInput');
            const friendName = friendNameInput ? friendNameInput.value.trim() : '';

            if (friendName) {
                showNotification(`${friendName} adlÄ± arkadaÅŸÄ±na davet gÃ¶nderildi! ğŸ‰ (SimÃ¼lasyon)`, 'success');
                if (friendNameInput) friendNameInput.value = ''; // Clear input
            } else {
                showNotification('LÃ¼tfen davet etmek istediÄŸiniz arkadaÅŸÄ±nÄ±zÄ±n adÄ±nÄ± girin.', 'info');
            }
        };

        window.showCompetitionsInfo = function() {
            showNotification('YarÄ±ÅŸma ve Ã¶zel etkinlik Ã¶zelliklerimiz Ã§ok yakÄ±nda aktif olacak! Bizi takipte kalÄ±n. ğŸ…', 'info');
        };

        // --- GEMINI API ENTEGRASYONLARI ---

        /**
         * Verilen malzemelerle Gemini API kullanarak bir tarif oluÅŸturur.
         * OluÅŸturulan tarifi uygulama durumuna kaydeder ve ekranda gÃ¶sterir.
         */
        async function generateRecipeWithAI() {
            const ingredientsInput = document.getElementById('recipeIngredientsInput');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const aiGeneratedRecipeDiv = document.getElementById('aiGeneratedRecipe');

            // DOM elementlerinin varlÄ±ÄŸÄ±nÄ± kontrol et
            if (!ingredientsInput || !loadingIndicator || !aiGeneratedRecipeDiv) {
                console.error("Tarif oluÅŸturma alanlarÄ± bulunamadÄ±.");
                showNotification('Tarif oluÅŸturma alanlarÄ± bulunamadÄ±!', 'error');
                return;
            }

            const ingredients = ingredientsInput.value.trim();
            if (!ingredients) {
                showNotification('LÃ¼tfen malzemeleri girin!', 'error');
                return;
            }

            loadingIndicator.style.display = 'block'; // YÃ¼kleniyor gÃ¶stergesini aÃ§
            aiGeneratedRecipeDiv.innerHTML = ''; // Ã–nceki tarifi temizle
            appState.aiGeneratedRecipe = null; // State'deki Ã¶nceki tarifi temizle

            // Gemini API iÃ§in prompt oluÅŸturma
            const prompt = `Generate a recipe using the following ingredients: ${ingredients}. Provide the response in JSON format according to this schema, ensuring ingredient quantities are specific and realistic:
            {
              "recipeName": "string",
              "ingredients": [
                {
                  "item": "string",
                  "quantity": "string"
                }
              ],
              "instructions": [
                "string"
              ]
            }. Provide recipe names and instructions in Turkish.`;

            try {
                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                
                const payload = {
                    contents: chatHistory,
                    generationConfig: {
                        responseMimeType: "application/json",
                        responseSchema: {
                            type: "OBJECT",
                            properties: {
                                "recipeName": { "type": "STRING" },
                                "ingredients": {
                                    "type": "ARRAY",
                                    "items": {
                                        "type": "OBJECT",
                                        "properties": {
                                            "item": { "type": "STRING" },
                                            "quantity": { "type": "STRING" }
                                        }
                                    }
                                },
                                "instructions": {
                                    "type": "ARRAY",
                                    "items": { "type": "STRING" }
                                }
                            },
                            "propertyOrdering": ["recipeName", "ingredients", "instructions"]
                        }
                    }
                };

                // Canvas ortamÄ± tarafÄ±ndan saÄŸlanacak olan API anahtarÄ±.
                // Bu anahtar otomatik olarak enjekte edilecektir.
                const apiKey = ""; 
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    console.error('API HatasÄ±:', errorData);
                    showNotification('Tarif oluÅŸturulurken hata oluÅŸtu: ' + (errorData.error?.message || 'Bilinmeyen Hata'), 'error');
                    return;
                }

                const result = await response.json();
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    
                    const jsonString = result.candidates[0].content.parts[0].text;
                    let generatedRecipe = null;
                    try {
                        generatedRecipe = JSON.parse(jsonString);
                    } catch (parseError) {
                        console.error("JSON ayrÄ±ÅŸtÄ±rma hatasÄ±:", parseError, "Ham metin:", jsonString);
                        showNotification('AI yanÄ±tÄ± Ã§Ã¶zÃ¼mlenemedi. LÃ¼tfen tekrar deneyin.', 'error');
                        return;
                    }

                    // Uygulama durumunu gÃ¼ncelle ve yeniden render et
                    updateState({ aiGeneratedRecipe: generatedRecipe });
                    showNotification('Tarif baÅŸarÄ±yla oluÅŸturuldu! ğŸ§‘â€ğŸ³', 'success');

                    // Yeni render dÃ¶ngÃ¼sÃ¼nden sonra tarifin gÃ¶rÃ¼nÃ¼r olmasÄ±nÄ± saÄŸla
                    // renderChef() zaten Ã§aÄŸrÄ±ldÄ±ÄŸÄ± iÃ§in bu satÄ±ra gerek kalmayabilir,
                    // ancak doÄŸrudan element iÃ§eriÄŸini gÃ¼ncellemeyi de dÃ¼ÅŸÃ¼nebiliriz.
                    // Åimdilik renderChef() iÃ§indeki conditional rendering'e gÃ¼veniyoruz.
                } else {
                    showNotification('AI tarif oluÅŸturamadÄ±. Daha fazla bilgi saÄŸlamayÄ± deneyin.', 'info');
                }

            } catch (error) {
                console.error('Fetch hatasÄ±:', error);
                showNotification('AÄŸ hatasÄ± veya API eriÅŸim sorunu: ' + error.message, 'error');
            } finally {
                loadingIndicator.style.display = 'none'; // YÃ¼kleniyor gÃ¶stergesini kapat
            }
        }

        /**
         * AI tarafÄ±ndan oluÅŸturulan tarifteki malzemeleri alÄ±ÅŸveriÅŸ listesine ekler.
         */
        function addRecipeIngredientsToList() {
            if (!appState.aiGeneratedRecipe || !appState.aiGeneratedRecipe.ingredients) {
                showNotification('Eklenilecek tarif malzemesi bulunamadÄ±!', 'error');
                return;
            }

            const newItems = [];
            appState.aiGeneratedRecipe.ingredients.forEach(item => {
                const emoji = getItemEmoji(item.item);
                // MiktarÄ± ve birimi ayÄ±klamaya Ã§alÄ±ÅŸ (Ã¶rn: "2 adet" -> 2, "adet")
                const quantityParts = item.quantity.match(/(\d+\.?\d*)\s*(\S*)/);
                let quantityValue = '1';
                let unitValue = 'adet';

                if (quantityParts && quantityParts[1]) {
                    quantityValue = quantityParts[1];
                    unitValue = quantityParts[2] || 'adet'; // Birim boÅŸsa 'adet' kullan
                } else {
                    // EÄŸer API'den gelen miktar sadece birim iÃ§eriyorsa veya sayÄ± yoksa
                    unitValue = item.quantity;
                    quantityValue = '1'; // VarsayÄ±lan miktar
                }

                const newItem = {
                    id: Date.now() + Math.random(),
                    name: item.item,
                    quantity: `${quantityValue} ${unitValue}`.trim(), // FormatÄ± koru
                    displayName: `${item.item} (${quantityValue} ${unitValue})`.trim(),
                    emoji: emoji,
                    completed: false,
                    completedBy: null,
                    addedBy: appState.user?.name || 'AI AÅŸÃ§Ä±',
                    category: categorizeItem(item.item),
                    addedAt: new Date().toLocaleString('tr-TR')
                };
                newItems.push(newItem);
            });

            const updatedShoppingList = [...appState.shoppingList, ...newItems];
            updateState({
                shoppingList: updatedShoppingList,
                aiGeneratedRecipe: null, // Malzemeler eklendikten sonra tarifi temizle
                currentPage: 'home' // Ana sayfaya geri dÃ¶n
            });
            showNotification(`${newItems.length} tarif malzemesi ana sayfaya eklendi! ğŸ›’`, 'success');
        }

        // --- GLOBAL WINDOW OBJEKTÄ°NE EKLEMELER ---
        window.generateQRCode = generateQRCode;
        window.startVoiceRecognition = startVoiceRecognition;
        window.selectSuggestion = selectSuggestion;
        window.showSuggestions = showSuggestions;
        window.generateRecipeWithAI = generateRecipeWithAI; // Yeni eklenen fonksiyon
        window.addRecipeIngredientsToList = addRecipeIngredientsToList; // Yeni eklenen fonksiyon

        window.handleLoginClick = function() {
            const input = document.getElementById('loginInput');
            if (input && input.value.trim()) {
                handleLogin(input.value.trim());
            } else {
                showNotification('LÃ¼tfen geÃ§erli bir kullanÄ±cÄ± adÄ± girin!', 'error');
            }
        };
        
        window.addNewItem = function() {
            const nameInput = document.getElementById('newItemInput');
            const quantityInput = document.getElementById('newQuantityInput');
            const unitSelect = document.getElementById('newUnitSelect');
            
            if (nameInput && nameInput.value.trim()) {
                const name = nameInput.value.trim();
                const quantity = quantityInput ? quantityInput.value : '1';
                const unit = unitSelect ? unitSelect.value : 'adet';
                addItem(name, quantity, unit);
            } else {
                showNotification('LÃ¼tfen Ã¼rÃ¼n adÄ± girin!', 'error');
            }
        };

        window.handleAiQueryClick = function() {
            const input = document.getElementById('aiQueryInput');
            if (input) {
                updateState({ aiQuery: input.value });
                handleAiQuery();
            }
        };

        window.updateChefName = function() {
            const input = document.getElementById('chefNameInput');
            if (input && input.value.trim()) {
                updateState({ chefName: input.value.trim() });
                showNotification(`AÅŸÃ§Ä±nÄ±zÄ±n adÄ± "${input.value.trim()}" olarak gÃ¼ncellendi! ğŸ‘¨â€ğŸ³`);
            } else {
                showNotification('LÃ¼tfen aÅŸÃ§Ä± adÄ± girin!', 'error');
            }
        };

        window.changePage = function(page) {
            updateState({ currentPage: page });
        };

        window.toggleItemComplete = toggleItemComplete;
        window.deleteItemFromList = deleteItemFromList;
        window.addAiSuggestionsToList = addAiSuggestionsToList;
    
        window.toggleDarkModeFunction = toggleDarkModeFunction;
        window.toggleSetting = toggleSetting;

        window.clearAllDataConfirm = function() {
            confirmAction('TÃ¼m verileriniz kalÄ±cÄ± olarak silinecektir. Bu iÅŸlemi yapmak istediÄŸinizden emin misiniz?', function() {
                localStorage.clear();
                location.reload();
            });
        };

        window.logout = function() {
            confirmAction('HesabÄ±nÄ±zdan Ã§Ä±kÄ±ÅŸ yapmak istediÄŸinizden emin misiniz?', function() {
                localStorage.clear();
                location.reload();
            });
        };

        // Render function - UygulamanÄ±n HTML iÃ§eriÄŸini gÃ¼nceller
        function render() {
            const app = document.getElementById('app');
            if (!app) {
                console.error("App container not found!");
                return;
            }

            if (!appState.user) {
                app.innerHTML = renderLogin();
            } else {
                switch (appState.currentPage) {
                    case 'home':
                        app.innerHTML = renderHome();
                        break;
                    case 'chef':
                        app.innerHTML = renderChef();
                        break;
                    case 'settings':
                        app.innerHTML = renderSettings();
                        break;
                    default:
                        app.innerHTML = renderHome();
                }
            }

            // AyarlarÄ± uygula
            if (appState.settings.darkMode) {
                document.documentElement.setAttribute('data-theme', 'dark');
            } else {
                document.documentElement.removeAttribute('data-theme');
            }
            document.body.classList.toggle('high-contrast', appState.settings.highContrast);
            document.body.classList.toggle('large-text', appState.settings.largeText);
        }

        // Initialize app
        // window.onload yerine DOMContentLoaded kullanmak daha gÃ¼venlidir.
        document.addEventListener('DOMContentLoaded', () => {
            render();
            syncWithOtherTabs();
            // EÄŸer URL'de bir paylaÅŸÄ±m kodu varsa, otomatik olarak listeye katÄ±l
            const urlParams = new URLSearchParams(window.location.search);
            const shareCodeFromUrl = urlParams.get('shareCode');
            if (shareCodeFromUrl && !appState.shareCode && appState.user) {
                // Sadece kullanÄ±cÄ± varsa otomatik katÄ±lmayÄ± dene
                joinSharedList(shareCodeFromUrl.toUpperCase());
                // URL'deki shareCode'u temizle
                history.replaceState({}, document.title, window.location.pathname);
            }
        });
    </script>
</body>
</html>
ï¿½
